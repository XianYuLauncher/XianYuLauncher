<Page
    x:Class="XianYuLauncher.Views.TutorialPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="using:XianYuLauncher.ViewModels"
    xmlns:helpers="using:XianYuLauncher.Helpers"
    mc:Ignorable="d">
    <Page.Resources>
        <helpers:EnumToBooleanConverter x:Key="EnumToBooleanConverter" />
    </Page.Resources>
    <Grid Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 标题区域 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock x:Uid="TutorialPage_Title" Text="新手教程" Style="{ThemeResource TitleTextBlockStyle}" FontSize="36" FontWeight="Bold" />
            <TextBlock x:Uid="TutorialPage_Subtitle" Text="请完成以下设置，以便正常运行Minecraft" Style="{ThemeResource BodyTextBlockStyle}" Margin="0,8,0,0" Opacity="0.7" />
        </StackPanel>

        <!-- 页面指示器 -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,20" Spacing="20">
            <TextBlock x:Uid="TutorialPage_StepText" x:Name="StepTextBlock" Text="步骤 1/3" Style="{ThemeResource SubtitleTextBlockStyle}" HorizontalAlignment="Center" VerticalAlignment="Center" />
            <ProgressBar Value="{x:Bind ViewModel.CurrentPageIndex, Mode=OneWay}" Minimum="0" Maximum="2" Width="200" VerticalAlignment="Center" />
        </StackPanel>

        <!-- 主要内容区域 -->
        <Grid Grid.Row="2">
            <!-- Minecraft路径设置页面 -->
            <StackPanel x:Name="PathSettingsPanel">
                <TextBlock x:Uid="TutorialPage_MinecraftPathTitle" Text="Minecraft 路径" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <StackPanel Margin="{StaticResource SmallTopBottomMargin}">
                    <StackPanel Orientation="Horizontal" Margin="{StaticResource XSmallTopMargin}" Spacing="8">
                        <TextBox 
                            x:Uid="TutorialPage_MinecraftPathTextBox"
                            Text="{x:Bind ViewModel.MinecraftPath, Mode=TwoWay}" 
                            PlaceholderText="请选择Minecraft游戏目录" 
                            Width="400" 
                            Margin="0,0,8,0"/>
                        <Button 
                            x:Uid="TutorialPage_BrowseButton"
                            Content="浏览..." 
                            Command="{x:Bind ViewModel.BrowseMinecraftPathCommand}"/>
                    </StackPanel>
                    <TextBlock 
                        x:Uid="TutorialPage_MinecraftPathDescription"
                        Text="Minecraft游戏目录，包含versions、saves等文件夹" 
                        Style="{ThemeResource CaptionTextBlockStyle}" 
                        Margin="{StaticResource XSmallTopMargin}" 
                        Opacity="0.7"/>
                </StackPanel>
            </StackPanel>

            <!-- Java设置页面 -->
            <StackPanel x:Name="JavaSettingsPanel" Visibility="Collapsed">
                <TextBlock x:Uid="TutorialPage_JavaSettingsTitle" Text="Java路径设置" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <StackPanel Margin="{StaticResource SmallTopBottomMargin}">
                    <!-- Java Versions List -->
                    <StackPanel Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock x:Uid="TutorialPage_InstalledJavaVersions" Text="已安装的Java版本" Style="{ThemeResource SubtitleTextBlockStyle}" Margin="0,0,0,8" />
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Right" Grid.Column="1">
                                <Button
                                    x:Uid="TutorialPage_AddJavaButton"
                                    Content="添加"
                                    Command="{x:Bind ViewModel.AddJavaVersionCommand}"
                                    IsEnabled="{x:Bind ViewModel.CanRefreshJavaVersions, Mode=OneWay}"
                                    Margin="0,0,8,0" ToolTipService.ToolTip="手动添加Java版本到列表" />
                                <Button
                                    x:Uid="TutorialPage_RefreshJavaButton"
                                    Content="刷新"
                                    Command="{x:Bind ViewModel.RefreshJavaVersionsCommand}"
                                    IsEnabled="{x:Bind ViewModel.CanRefreshJavaVersions, Mode=OneWay}"
                                    Margin="0,0,8,0" ToolTipService.ToolTip="刷新已安装的Java版本列表" />
                                <ProgressRing IsActive="{x:Bind ViewModel.IsLoadingJavaVersions, Mode=OneWay}" Width="20" Height="20" VerticalAlignment="Center" />
                            </StackPanel>
                        </Grid>
                        <ListBox
                            ItemsSource="{x:Bind ViewModel.JavaVersions, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedJavaVersion, Mode=TwoWay}"
                            Height="200">
                            <ListBox.ItemTemplate>
                                <DataTemplate x:DataType="viewModels:JavaVersionInfo">
                                    <StackPanel Margin="4">
                                        <TextBlock Text="{x:Bind Version}" Style="{ThemeResource BodyTextBlockStyle}" />
                                        <TextBlock Text="{x:Bind Path}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Java选择方式 -->
                    <TextBlock x:Uid="TutorialPage_JavaSelectionMode" Text="Java选择方式" Margin="0,20,0,0" />
                    <StackPanel Margin="0,8,0,0">
                        <RadioButton
                            x:Uid="TutorialPage_AutoJavaSelection"
                            Content="自动从列表内选择Java"
                            Command="{x:Bind ViewModel.SwitchJavaSelectionModeCommand}"
                            CommandParameter="Auto"
                            IsChecked="{x:Bind ViewModel.JavaSelectionMode, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Auto, Mode=OneWay}"
                            FontSize="15"
                            GroupName="JavaSelectionMode"
                            ToolTipService.ToolTip="启动时根据游戏版本自动从列表中选择合适的Java版本">
                        </RadioButton>
                        <RadioButton
                            x:Uid="TutorialPage_ManualJavaSelection"
                            Content="手动选择Java"
                            Command="{x:Bind ViewModel.SwitchJavaSelectionModeCommand}"
                            CommandParameter="Manual"
                            IsChecked="{x:Bind ViewModel.JavaSelectionMode, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Manual, Mode=OneWay}"
                            FontSize="15"
                            GroupName="JavaSelectionMode"
                            ToolTipService.ToolTip="使用当前选择的Java版本">
                        </RadioButton>
                    </StackPanel>
                    
                    <!-- Java路径设置 -->
                    <TextBlock x:Uid="TutorialPage_JavaPathTitle" Text="Java路径" Margin="0,20,0,0" />
                    <StackPanel Orientation="Horizontal" Margin="{StaticResource XSmallTopMargin}" Spacing="8">
                        <TextBox 
                            x:Uid="TutorialPage_JavaPathTextBox"
                            Text="{x:Bind ViewModel.JavaPath, Mode=TwoWay}" 
                            PlaceholderText="请选择Java可执行文件路径" 
                            Width="400"
                            Margin="0,0,8,0"/>
                        <Button 
                            x:Uid="TutorialPage_BrowseJavaButton"
                            Content="浏览..." 
                            Command="{x:Bind ViewModel.BrowseJavaPathCommand}"/>
                        <Button 
                            x:Uid="TutorialPage_ClearJavaButton"
                            Content="清除" 
                            Command="{x:Bind ViewModel.ClearJavaPathCommand}"/>
                    </StackPanel>
                    <TextBlock 
                        x:Uid="TutorialPage_JavaPathDescription"
                        Text="使用'添加'按钮手动添加Java版本到列表，或直接指定Java路径" 
                        Style="{ThemeResource CaptionTextBlockStyle}" 
                        Margin="{StaticResource XSmallTopMargin}" 
                        Opacity="0.7"/>
                </StackPanel>
            </StackPanel>

            <!-- 角色选择页面 -->
            <StackPanel x:Name="ProfileSettingsPanel" Visibility="Collapsed">
                <TextBlock x:Uid="TutorialPage_ProfileSelectionTitle" Text="角色选择" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <StackPanel Margin="{StaticResource SmallTopBottomMargin}">
                    <!-- 登录方式选择 -->
                    <StackPanel Margin="{StaticResource XSmallTopMargin}">
                        <TextBlock x:Uid="TutorialPage_LoginTypeTitle" Text="登录方式" Margin="0,0,0,8" />
                        <StackPanel Orientation="Horizontal" Spacing="16">
                            <RadioButton
                                x:Uid="TutorialPage_MicrosoftLoginRadio"
                                Content="微软登录"
                                Command="{x:Bind ViewModel.SwitchLoginTypeCommand}"
                                CommandParameter="Microsoft"
                                IsChecked="{x:Bind ViewModel.IsMicrosoftLogin, Mode=TwoWay}"
                                FontSize="15"
                                GroupName="LoginType" />
                            <RadioButton
                                x:Uid="TutorialPage_OfflineLoginRadio"
                                Content="离线登录"
                                Command="{x:Bind ViewModel.SwitchLoginTypeCommand}"
                                CommandParameter="Offline"
                                IsChecked="{x:Bind ViewModel.IsOfflineLogin, Mode=TwoWay}"
                                IsEnabled="{x:Bind ViewModel.IsOfflineLoginAllowed, Mode=OneWay}"
                                FontSize="15"
                                GroupName="LoginType" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- 微软登录UI -->
                    <StackPanel x:Name="MicrosoftLoginPanel" Margin="{StaticResource SmallTopMargin}" Visibility="{x:Bind ViewModel.IsMicrosoftLogin, Mode=OneWay}">
                        <!-- 登录状态显示 -->
                        <StackPanel 
                            Visibility="{x:Bind ViewModel.IsLoggingIn, Mode=OneWay}" 
                            Orientation="Horizontal" 
                            Margin="0,0,0,20" 
                            Spacing="12" 
                            VerticalAlignment="Center">
                            <ProgressRing 
                                IsActive="{x:Bind ViewModel.IsLoggingIn, Mode=OneWay}" 
                                Width="20" 
                                Height="20" 
                                Foreground="{ThemeResource SystemControlHighlightAccentBrush}" />
                            <TextBlock 
                                Text="{x:Bind ViewModel.LoginStatus, Mode=OneWay}" 
                                Style="{ThemeResource BodyTextBlockStyle}" 
                                Foreground="{ThemeResource SystemControlHighlightAccentBrush}" 
                                TextWrapping="WrapWholeWords" />
                        </StackPanel>
                        
                        <!-- 角色预览和名称 -->
                        <StackPanel Orientation="Horizontal" Margin="0,20,0,20" VerticalAlignment="Center" Spacing="16">
                            <!-- 角色预览 -->
                            <Border 
                                x:Name="MicrosoftProfileAvatarBorder"
                                Width="48" 
                                Height="48" 
                                CornerRadius="4" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Center">
                                <Image 
                                    x:Name="MicrosoftProfileAvatar"
                                    Source="ms-appx:///Assets/Icons/Avatars/Steve.png" 
                                    Width="48" 
                                    Height="48" 
                                    HorizontalAlignment="Center" 
                                    VerticalAlignment="Center" 
                                    Stretch="Fill" />
                            </Border>
                            
                            <!-- 角色名称 -->
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock x:Uid="TutorialPage_ProfileNameTitle" Text="角色名称" Margin="0,0,0,4" />
                                <TextBlock 
                                    x:Uid="TutorialPage_ProfileNameValue"
                                    Text="{x:Bind ViewModel.ProfileName, Mode=OneWay}" 
                                    Width="200" 
                                    FontWeight="SemiBold" />
                            </StackPanel>
                        </StackPanel>
                        
                        <Button 
                            x:Uid="TutorialPage_MicrosoftLoginButton"
                            Command="{x:Bind ViewModel.MicrosoftLoginCommand}" 
                            Width="300" 
                            Height="40" 
                            FontSize="15" 
                            IsEnabled="{x:Bind ViewModel.IsNotLoggingIn, Mode=OneWay}">
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="" FontSize="16" />
                                <TextBlock x:Uid="TutorialPage_LoginButtonText" Text="登录" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                    
                    <!-- 离线登录UI -->
                    <StackPanel x:Name="OfflineLoginPanel" Margin="{StaticResource SmallTopMargin}" Visibility="{x:Bind ViewModel.IsOfflineLogin, Mode=OneWay}">
                        <!-- 角色预览和名称 -->
                        <StackPanel Orientation="Horizontal" Margin="0,20,0,20" VerticalAlignment="Center" Spacing="16">
                            <!-- 角色预览 -->
                            <Border 
                                x:Name="ProfileAvatarBorder"
                                Width="48" 
                                Height="48" 
                                CornerRadius="4" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Center">
                                <Image 
                                    x:Name="ProfileAvatar"
                                    Source="ms-appx:///Assets/Icons/Avatars/Steve.png" 
                                    Width="48" 
                                    Height="48" 
                                    HorizontalAlignment="Center" 
                                    VerticalAlignment="Center" 
                                    Stretch="Fill" />
                            </Border>
                            
                            <!-- 角色名称 -->
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock x:Uid="TutorialPage_OfflineProfileNameTitle" Text="角色名称" Margin="0,0,0,4" />
                                <TextBox 
                                    x:Uid="TutorialPage_OfflineProfileNameTextBox"
                                    Text="{x:Bind ViewModel.OfflineProfileName, Mode=TwoWay}" 
                                    PlaceholderText="请输入角色名称" 
                                    Width="200" />
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </Grid>

        <!-- 导航按钮区域 -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0" Spacing="12">
            <Button 
                x:Uid="TutorialPage_PreviousButton"
                x:Name="PreviousButton" 
                Content="上一步" 
                Command="{x:Bind ViewModel.PreviousCommand}" 
                IsEnabled="{x:Bind ViewModel.CanGoPrevious, Mode=OneWay}" 
                Width="100" />
            <Button 
                x:Uid="TutorialPage_NextButton"
                x:Name="NextButton" 
                Content="下一步" 
                Command="{x:Bind ViewModel.NextCommand}" 
                Width="100" 
                Visibility="{x:Bind ViewModel.IsNotLastPage, Mode=OneWay}" />
            <Button 
                x:Uid="TutorialPage_FinishButton"
                x:Name="FinishButton" 
                Content="完成" 
                Command="{x:Bind ViewModel.FinishCommand}" 
                Visibility="{x:Bind ViewModel.IsLastPage, Mode=OneWay}" 
                Width="100" />
        </StackPanel>
    </Grid>
</Page>