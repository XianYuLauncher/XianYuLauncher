<Page
    x:Class="XianYuLauncher.Views.LaunchPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="using:XianYuLauncher.ViewModels"
    mc:Ignorable="d">

    <Page.DataContext>
        <viewModels:LaunchViewModel />
    </Page.DataContext>

    <Grid x:Name="ContentArea" Padding="40,60,20,20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 标题区域 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,40">
            <TextBlock Text="XianYu Launcher" Style="{StaticResource TitleTextBlockStyle}" FontSize="48" FontWeight="Bold" />
            <TextBlock x:Uid="LaunchPage_Subtitle" Text="Minecraft 启动器" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,4,0,0" Opacity="0.8" />
        </StackPanel>

        <!-- 主要内容区域 -->
        <StackPanel Grid.Row="1" Spacing="28" MaxWidth="600" HorizontalAlignment="Left" VerticalAlignment="Top">
            <!-- 版本选择 -->
            <StackPanel Spacing="10">
                <TextBlock x:Uid="LaunchPage_VersionSelection" Text="选择Minecraft版本" Style="{StaticResource TitleTextBlockStyle}" FontSize="18" FontWeight="SemiBold" />
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <ComboBox 
                        x:Name="VersionComboBox"
                        ItemsSource="{x:Bind ViewModel.InstalledVersions, Mode=OneWay}"
                        SelectedItem="{x:Bind ViewModel.SelectedVersion, Mode=TwoWay}"
                        x:Uid="LaunchPage_SelectVersionPlaceholder"
                        PlaceholderText="请选择已安装的版本"
                        HorizontalAlignment="Stretch"
                        Height="40"
                        Padding="12,0,12,0"
                        FontSize="14" />
                    <Button 
                        Grid.Column="1"
                        Margin="12,0,0,0"
                        Command="{x:Bind ViewModel.LoadInstalledVersionsCommand}"
                        HorizontalAlignment="Right"
                        Height="40"
                        Width="40"
                        Style="{StaticResource DefaultButtonStyle}"
                        x:Uid="LaunchPage_RefreshVersionsTooltip"
                        ToolTipService.ToolTip="刷新版本列表">
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xe72c;" FontSize="18" />
                    </Button>
                </Grid>
            </StackPanel>



            <!-- 角色选择 -->
            <StackPanel Spacing="10">
                <TextBlock x:Uid="LaunchPage_PlayerName" Text="选择角色" Style="{StaticResource TitleTextBlockStyle}" FontSize="18" FontWeight="SemiBold" />
                <Button 
                    x:Name="ProfileButton"
                    HorizontalAlignment="Stretch"
                    Height="40"
                    Padding="12,0,12,0"
                    FontSize="14">
                    <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                        <!-- 头像 -->
                        <Border 
                            Width="24"
                            Height="24"
                            CornerRadius="4"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center">
                            <Image 
                                x:Name="ProfileAvatar"
                                Width="24"
                                Height="24"
                                Source="ms-appx:///Assets/DefaultAvatar.png"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" 
                                Stretch="Fill" />
                        </Border>
                        <!-- 角色名 -->
                        <TextBlock 
                            Text="{x:Bind ViewModel.SelectedProfile.Name, Mode=OneWay}"
                            VerticalAlignment="Center"
                            FontSize="14" />
                    </StackPanel>
                    <Button.Flyout>
                        <MenuFlyout x:Name="ProfileMenuFlyout" Opening="ProfileMenuFlyout_Opening">
                            <!-- 角色列表将在代码中动态生成 -->
                            <!-- 添加角色选项 -->
                            <MenuFlyoutItem 
                                x:Uid="LaunchPage_AddProfile"
                                Text="添加角色"
                                Click="AddProfileMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <SymbolIcon Symbol="Add" />
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </Button.Flyout>
                </Button>
            </StackPanel>

            <!-- 启动按钮 -->
            <Button 
                x:Name="LaunchButton"
                x:Uid="LaunchPage_LaunchGame"
                Content="启动游戏"
                Style="{StaticResource AccentButtonStyle}"
                Command="{x:Bind ViewModel.LaunchGameCommand}"
                IsEnabled="{x:Bind ViewModel.SelectedVersion, Converter={StaticResource StringNullOrEmptyToBoolConverter}, Mode=OneWay}"
                HorizontalAlignment="Stretch" 
                Height="48"
                FontSize="16"
                FontWeight="SemiBold"
                Margin="0,16,0,0" />

            <!-- 启动状态 -->
            <TextBlock 
                x:Name="StatusTextBlock"
                Text="{x:Bind ViewModel.LaunchStatus, Mode=OneWay}"
                Style="{StaticResource BodyTextBlockStyle}"
                TextAlignment="Left" 
                Foreground="{ThemeResource SystemControlForegroundAccentBrush}"
                FontSize="14"
                Margin="0,12,0,0"
                Visibility="Collapsed" />
            


            <!-- 下载进度条 -->
            <ProgressBar 
                x:Name="DownloadProgressBar"
                Value="{x:Bind ViewModel.DownloadProgress, Mode=OneWay}"
                Minimum="0"
                Maximum="100"
                Height="8"
                Margin="0,8,0,0"
                Visibility="{x:Bind ViewModel.DownloadProgress, Mode=OneWay, Converter={StaticResource ProgressVisibilityConverter}}"
                Foreground="{ThemeResource SystemControlForegroundAccentBrush}"
                Background="{ThemeResource SystemControlBackgroundBaseLowBrush}"
                BorderThickness="0"
                CornerRadius="4" />
                

        </StackPanel>
        <!-- 启动成功提示 -->
        <InfoBar 
            x:Name="LaunchSuccessInfoBar"
            Grid.Row="2"
            x:Uid="LaunchPage_SuccessTitle"
            Title="游戏启动成功"
            Message="{x:Bind ViewModel.LaunchSuccessMessage, Mode=OneWay}"
            IsOpen="{x:Bind ViewModel.IsLaunchSuccessInfoBarOpen, Mode=TwoWay}"
            Visibility="{x:Bind ViewModel.IsLaunchSuccessInfoBarOpen, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
            Margin="0,20,0,0" />
        
    </Grid>
</Page>
