<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="XianYuLauncher.Views.WorldDataPacksPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:XianYuLauncher.Models.VersionManagement"
    xmlns:helpers="using:XianYuLauncher.Helpers"
    mc:Ignorable="d">

    <Page.Resources>
        <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <helpers:StringNullOrEmptyToBoolConverter x:Key="StringNullOrEmptyToVisibilityConverter"/>
    </Page.Resources>

    <Grid>
        <!-- 数据包列表 -->
        <ListView 
            x:Name="DataPackListView"
            ItemsSource="{x:Bind ViewModel.DataPacks, Mode=OneWay}"
            SelectionMode="None"
            IsItemClickEnabled="False"
            Background="Transparent"
            BorderThickness="0"
            VerticalAlignment="Stretch">
            <ListView.Resources>
                <Style TargetType="ScrollViewer">
                    <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                    <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
                    <Setter Property="IsScrollInertiaEnabled" Value="True"/>
                </Style>
            </ListView.Resources>
            <ListView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsStackPanel/>
                </ItemsPanelTemplate>
            </ListView.ItemsPanel>
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <Setter Property="Margin" Value="0,0,0,12"/>
                    <Setter Property="Padding" Value="0"/>
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="Background" Value="Transparent"/>
                </Style>
            </ListView.ItemContainerStyle>
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:DataPackInfo">
                    <Grid MinHeight="80" 
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          CornerRadius="8" 
                          Padding="20,16" 
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- 数据包图标 -->
                        <Border Grid.Column="0" 
                                Width="48" 
                                Height="48" 
                                CornerRadius="8"
                                Background="{ThemeResource LayerFillColorDefaultBrush}"
                                VerticalAlignment="Center" 
                                Margin="0,0,16,0">
                            <Grid>
                                <FontIcon Glyph="&#xE8B7;" 
                                          FontSize="24" 
                                          VerticalAlignment="Center" 
                                          HorizontalAlignment="Center"
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <Image Source="{x:Bind Icon, Mode=OneWay}" 
                                       Stretch="UniformToFill"/>
                            </Grid>
                        </Border>

                        <!-- 数据包名称和描述 -->
                        <StackPanel Grid.Column="1" 
                                    VerticalAlignment="Center" 
                                    Spacing="6">
                            <TextBlock Text="{x:Bind Name, Mode=OneWay}" 
                                       FontSize="15" 
                                       FontWeight="SemiBold"
                                       Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                       TextTrimming="CharacterEllipsis"/>

                            <!-- 描述区域 -->
                            <Grid>
                                <!-- 加载中指示器 -->
                                <StackPanel Orientation="Horizontal" Spacing="8" 
                                           Visibility="{x:Bind IsLoadingDescription, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <ProgressRing Width="14" Height="14" IsActive="True"/>
                                    <TextBlock Text="加载描述中..." 
                                               x:Uid="WorldDataPacks_LoadingDescription"
                                               FontSize="13" 
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>

                                <!-- 描述文本 -->
                                <TextBlock Text="{x:Bind Description, Mode=OneWay}" 
                                           FontSize="13" 
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           TextWrapping="Wrap"
                                           MaxLines="2"
                                           TextTrimming="CharacterEllipsis"
                                           Visibility="{x:Bind Description, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToVisibilityConverter}}"/>
                            </Grid>
                        </StackPanel>

                        <!-- 删除按钮 -->
                        <Button Grid.Column="2"
                                VerticalAlignment="Center"
                                Click="DeleteDataPackButton_Click"
                                Style="{StaticResource SubtleButtonStyle}"
                                Height="32"
                                Padding="16,0">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE74D;" FontSize="14"/>
                                <TextBlock Text="删除" x:Uid="WorldDataPacks_Delete" FontSize="13"/>
                            </StackPanel>
                        </Button>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- 空列表提示 -->
        <StackPanel Visibility="{x:Bind ViewModel.ShowDataPackEmptyState, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center" 
                    Spacing="16">
            <FontIcon Glyph="&#xE8B7;" 
                      FontSize="64" 
                      Foreground="{ThemeResource TextFillColorTertiaryBrush}" 
                      HorizontalAlignment="Center"/>
            <TextBlock Text="暂无数据包" 
                       x:Uid="WorldDataPacks_EmptyTitle"
                       FontSize="18" 
                       FontWeight="SemiBold"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                       TextAlignment="Center"/>
            <TextBlock Text="将数据包文件放入 datapacks 文件夹" 
                       x:Uid="WorldDataPacks_EmptyDescription"
                       FontSize="14" 
                       Foreground="{ThemeResource TextFillColorTertiaryBrush}" 
                       TextAlignment="Center"/>
            
            <!-- 打开文件夹按钮 -->
            <Button Command="{x:Bind ViewModel.OpenDataPackFolderCommand}"
                    Margin="0,8,0,0"
                    HorizontalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE8B7;" FontSize="16"/>
                    <TextBlock Text="打开文件夹" x:Uid="WorldDataPacks_OpenFolder"/>
                </StackPanel>
            </Button>
        </StackPanel>
    </Grid>
</Page>
