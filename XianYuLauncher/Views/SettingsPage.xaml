<Page
    x:Class="XianYuLauncher.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="using:XianYuLauncher.Helpers"
    xmlns:viewModels="using:XianYuLauncher.ViewModels"
    xmlns:xaml="using:Microsoft.UI.Xaml"
    xmlns:animations="using:CommunityToolkit.WinUI.Animations"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    mc:Ignorable="d">
    <Page.Resources>
        <helpers:EnumToBooleanConverter x:Key="EnumToBooleanConverter" />
        <helpers:StringToBooleanConverter x:Key="StringToBooleanConverter" />
        <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <helpers:MaterialTypeToLocalizedStringConverter x:Key="MaterialTypeToLocalizedStringConverter" />
        <helpers:BoolNegationConverter x:Key="BoolNegationConverter" />
        <helpers:BoolToFontWeightConverter x:Key="BoolToFontWeightConverter" />
        <helpers:ColorToBrushConverter x:Key="ColorToBrushConverter" />
        <helpers:StringNullOrEmptyToBoolConverter x:Key="StringNullOrEmptyToBoolConverter" />
    </Page.Resources>
    <Grid x:Name="ContentArea" Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 标题区域 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock x:Name="PageTitle" x:Uid="SettingsPage_Title" Text="设置" Style="{ThemeResource TitleTextBlockStyle}" FontSize="36" FontWeight="Bold" />
            <TextBlock x:Name="PageSubtitle" x:Uid="SettingsPage_Subtitle" Text="配置启动器设置" Style="{ThemeResource BodyTextBlockStyle}" Margin="0,8,0,0" Opacity="0.7" />
        </StackPanel>

        <!-- 主要内容区域 -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Spacing="4" Padding="0,0,16,20">
                <animations:Implicit.ShowAnimations>
                    <animations:TranslationAnimation Duration="0:0:0.35" From="0, 40, 0" To="0" EasingMode="EaseOut" />
                    <animations:OpacityAnimation Duration="0:0:0.35" From="0" To="1.0" />
                </animations:Implicit.ShowAnimations>

                <!-- ==================== 游戏设置 ==================== -->
                <TextBlock x:Uid="Settings_GameSection" Text="游戏" Style="{ThemeResource BodyStrongTextBlockStyle}" Margin="0,0,0,4" />

                <!-- Minecraft 游戏目录 -->
                <controls:SettingsExpander x:Uid="Settings_MinecraftPath" Header="Minecraft 游戏目录" Description="管理游戏目录，双击列表项可快速切换">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE8B7;" />
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Content>
                        <Grid HorizontalAlignment="Right">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Button x:Uid="Settings_AddDirectory" Content="添加目录" Command="{x:Bind ViewModel.AddMinecraftPathCommand}" />
                                <Button x:Uid="Settings_RemoveDirectory" Content="删除" Command="{x:Bind ViewModel.RemoveMinecraftPathCommand}" />
                            </StackPanel>
                        </Grid>
                    </controls:SettingsExpander.Content>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard ContentAlignment="Vertical" HorizontalContentAlignment="Stretch" Background="Transparent" BorderThickness="0" Padding="0">
                            <ListBox
                                ItemsSource="{x:Bind ViewModel.MinecraftPaths, Mode=OneWay}"
                                SelectedItem="{x:Bind ViewModel.SelectedMinecraftPathItem, Mode=TwoWay}"
                                Height="150"
                                DoubleTapped="MinecraftPathListBox_DoubleTapped"
                                Background="Transparent"
                                BorderThickness="0">
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                        <Setter Property="Padding" Value="0" />
                                        <Setter Property="Margin" Value="0" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <Grid x:Name="Root" Background="{TemplateBinding Background}" CornerRadius="{TemplateBinding CornerRadius}" Padding="{TemplateBinding Padding}">
                                                        <VisualStateManager.VisualStateGroups>
                                                            <VisualStateGroup x:Name="CommonStates">
                                                                <VisualState x:Name="Normal" />
                                                                <VisualState x:Name="PointerOver">
                                                                    <VisualState.Setters>
                                                                        <Setter Target="Root.Background" Value="{ThemeResource SubtleFillColorSecondaryBrush}" />
                                                                    </VisualState.Setters>
                                                                </VisualState>
                                                                <VisualState x:Name="Pressed">
                                                                    <VisualState.Setters>
                                                                        <Setter Target="Root.Background" Value="{ThemeResource SubtleFillColorTertiaryBrush}" />
                                                                    </VisualState.Setters>
                                                                </VisualState>
                                                                <VisualState x:Name="Selected">
                                                                    <VisualState.Setters>
                                                                        <Setter Target="Root.Background" Value="Transparent" />
                                                                    </VisualState.Setters>
                                                                </VisualState>
                                                                <VisualState x:Name="SelectedUnfocused">
                                                                    <VisualState.Setters>
                                                                        <Setter Target="Root.Background" Value="Transparent" />
                                                                    </VisualState.Setters>
                                                                </VisualState>
                                                                <VisualState x:Name="SelectedPointerOver">
                                                                    <VisualState.Setters>
                                                                        <Setter Target="Root.Background" Value="{ThemeResource SubtleFillColorSecondaryBrush}" />
                                                                    </VisualState.Setters>
                                                                </VisualState>
                                                                <VisualState x:Name="SelectedPressed">
                                                                    <VisualState.Setters>
                                                                        <Setter Target="Root.Background" Value="{ThemeResource SubtleFillColorTertiaryBrush}" />
                                                                    </VisualState.Setters>
                                                                </VisualState>
                                                            </VisualStateGroup>
                                                        </VisualStateManager.VisualStateGroups>
                                                        <ContentPresenter x:Name="ContentPresenter"
                                                                        Content="{TemplateBinding Content}"
                                                                        ContentTemplate="{TemplateBinding ContentTemplate}"
                                                                        ContentTransitions="{TemplateBinding ContentTransitions}"
                                                                        HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                                                    </Grid>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                                <ListBox.ItemTemplate>
                                    <DataTemplate x:DataType="viewModels:MinecraftPathItem">
                                        <controls:SettingsCard HorizontalAlignment="Stretch"
                                                               ContentAlignment="Vertical"
                                                               Padding="16,10"
                                                               IsClickEnabled="False"
                                                               Background="Transparent">
                                            <controls:SettingsCard.Header>
                                                <TextBlock Text="{x:Bind Name, Mode=OneWay}" 
                                                           FontWeight="{x:Bind IsActive, Mode=OneWay, Converter={StaticResource BoolToFontWeightConverter}}" />
                                            </controls:SettingsCard.Header>
                                            <controls:SettingsCard.Description>
                                                <TextBlock Text="{x:Bind Path, Mode=OneWay}" Opacity="0.7" TextTrimming="CharacterEllipsis"/>
                                            </controls:SettingsCard.Description>
                                            <controls:SettingsCard.HeaderIcon>
                                                <FontIcon Glyph="&#xE73E;" FontSize="16" Foreground="{ThemeResource SystemAccentColor}"
                                                          Visibility="{x:Bind IsActive, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                                            </controls:SettingsCard.HeaderIcon>
                                        </controls:SettingsCard>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <!-- Java 版本管理 -->
                <controls:SettingsExpander x:Uid="Settings_JavaVersionManagement" Header="Java 版本管理" Description="管理已安装的 Java 运行时">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE756;" />
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Content>
                        <Grid HorizontalAlignment="Right">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Button x:Uid="Settings_DownloadJava" Command="{x:Bind ViewModel.DownloadJavaCommand}"
                                        IsEnabled="{x:Bind ViewModel.CanRefreshJavaVersions, Mode=OneWay}"
                                        ToolTipService.ToolTip="{Binding RelativeSource={RelativeSource Self}, Path=Content}">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <FontIcon Glyph="&#xE896;" FontSize="14" />
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                                <Button x:Uid="Settings_Add" Command="{x:Bind ViewModel.AddJavaVersionCommand}"
                                        IsEnabled="{x:Bind ViewModel.CanRefreshJavaVersions, Mode=OneWay}"
                                        ToolTipService.ToolTip="{Binding RelativeSource={RelativeSource Self}, Path=Content}">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <FontIcon Glyph="&#xE710;" FontSize="14" />
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                                <Button x:Uid="Settings_Refresh" Command="{x:Bind ViewModel.RefreshJavaVersionsCommand}"
                                        IsEnabled="{x:Bind ViewModel.CanRefreshJavaVersions, Mode=OneWay}"
                                        ToolTipService.ToolTip="{Binding RelativeSource={RelativeSource Self}, Path=Content}">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <FontIcon Glyph="&#xE72C;" FontSize="14" />
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                                <Button x:Uid="Settings_Clear" Command="{x:Bind ViewModel.ClearJavaVersionsCommand}"
                                        IsEnabled="{x:Bind ViewModel.CanRefreshJavaVersions, Mode=OneWay}"
                                        ToolTipService.ToolTip="{Binding RelativeSource={RelativeSource Self}, Path=Content}">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <FontIcon Glyph="&#xE74D;" FontSize="14" />
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                                <ProgressRing IsActive="{x:Bind ViewModel.IsLoadingJavaVersions, Mode=OneWay}" 
                                              Visibility="{x:Bind ViewModel.IsLoadingJavaVersions, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                              Width="20" Height="20" />
                            </StackPanel>
                        </Grid>
                    </controls:SettingsExpander.Content>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard ContentAlignment="Vertical" HorizontalContentAlignment="Stretch" Background="Transparent" BorderThickness="0" Padding="0">
                            <ListBox ItemsSource="{x:Bind ViewModel.JavaVersions, Mode=OneWay}" SelectedItem="{x:Bind ViewModel.SelectedJavaVersion, Mode=TwoWay}"
                                        Height="180" Background="Transparent" BorderThickness="0">
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                        <Setter Property="Padding" Value="0" />
                                        <Setter Property="Margin" Value="0" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <Grid x:Name="Root" Background="{TemplateBinding Background}" CornerRadius="{TemplateBinding CornerRadius}" Padding="{TemplateBinding Padding}">
                                                        <VisualStateManager.VisualStateGroups>
                                                            <VisualStateGroup x:Name="CommonStates">
                                                                <VisualState x:Name="Normal" />
                                                                <VisualState x:Name="PointerOver">
                                                                    <VisualState.Setters>
                                                                        <Setter Target="Root.Background" Value="{ThemeResource SubtleFillColorSecondaryBrush}" />
                                                                    </VisualState.Setters>
                                                                </VisualState>
                                                                <VisualState x:Name="Pressed">
                                                                    <VisualState.Setters>
                                                                        <Setter Target="Root.Background" Value="{ThemeResource SubtleFillColorTertiaryBrush}" />
                                                                    </VisualState.Setters>
                                                                </VisualState>
                                                                <VisualState x:Name="Selected">
                                                                    <VisualState.Setters>
                                                                        <Setter Target="Root.Background" Value="Transparent" />
                                                                    </VisualState.Setters>
                                                                </VisualState>
                                                                <VisualState x:Name="SelectedUnfocused">
                                                                    <VisualState.Setters>
                                                                        <Setter Target="Root.Background" Value="Transparent" />
                                                                    </VisualState.Setters>
                                                                </VisualState>
                                                                <VisualState x:Name="SelectedPointerOver">
                                                                    <VisualState.Setters>
                                                                        <Setter Target="Root.Background" Value="{ThemeResource SubtleFillColorSecondaryBrush}" />
                                                                    </VisualState.Setters>
                                                                </VisualState>
                                                                <VisualState x:Name="SelectedPressed">
                                                                    <VisualState.Setters>
                                                                        <Setter Target="Root.Background" Value="{ThemeResource SubtleFillColorTertiaryBrush}" />
                                                                    </VisualState.Setters>
                                                                </VisualState>
                                                            </VisualStateGroup>
                                                        </VisualStateManager.VisualStateGroups>
                                                        <ContentPresenter x:Name="ContentPresenter"
                                                                        Content="{TemplateBinding Content}"
                                                                        ContentTemplate="{TemplateBinding ContentTemplate}"
                                                                        ContentTransitions="{TemplateBinding ContentTransitions}"
                                                                        HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                                                    </Grid>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                                <ListBox.ItemTemplate>
                                    <DataTemplate x:DataType="viewModels:JavaVersionInfo">
                                        <controls:SettingsCard HorizontalAlignment="Stretch"
                                                                ContentAlignment="Vertical"
                                                                Padding="16,10"
                                                                IsClickEnabled="False"
                                                                Background="Transparent">
                                            <controls:SettingsCard.Header>
                                                <TextBlock Text="{x:Bind Version}" FontWeight="SemiBold" />
                                            </controls:SettingsCard.Header>
                                            <controls:SettingsCard.Description>
                                                <TextBlock Text="{x:Bind Path}" Opacity="0.7" TextTrimming="CharacterEllipsis"/>
                                            </controls:SettingsCard.Description>
                                        </controls:SettingsCard>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </controls:SettingsCard>
                        <controls:SettingsCard x:Uid="Settings_JavaSelectionMode" Header="Java 选择方式" Description="选择启动游戏时使用的 Java 版本" Background="Transparent" BorderThickness="0" Padding="16,12,0,12">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <RadioButton Content="自动" IsChecked="{x:Bind ViewModel.JavaSelectionMode, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Auto, Mode=OneWay}"
                                             Command="{x:Bind ViewModel.SwitchJavaSelectionModeCommand}" CommandParameter="Auto" GroupName="JavaMode" />
                                <RadioButton Content="手动" IsChecked="{x:Bind ViewModel.JavaSelectionMode, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Manual, Mode=OneWay}"
                                             Command="{x:Bind ViewModel.SwitchJavaSelectionModeCommand}" CommandParameter="Manual" GroupName="JavaMode" />
                            </StackPanel>
                        </controls:SettingsCard>
                        <controls:SettingsCard x:Uid="Settings_JavaPathLabel" Header="Java 路径" Description="手动指定 Java 可执行文件路径" Background="Transparent" BorderThickness="0" Padding="16,12,0,12">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBox Text="{x:Bind ViewModel.JavaPath, Mode=TwoWay}" PlaceholderText="请选择Java可执行文件路径" Width="280" IsReadOnly="True" />
                                <Button x:Uid="Settings_Browse" Content="浏览..." Command="{x:Bind ViewModel.BrowseJavaPathCommand}" />
                                <Button x:Uid="Settings_Clear" Content="清除" Command="{x:Bind ViewModel.ClearJavaPathCommand}" />
                            </StackPanel>
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>
                
                <!-- 全局 JVM 参数 -->
                <controls:SettingsExpander x:Uid="Settings_GlobalCustomJvmArguments" Header="全局自定义 JVM 参数" Description="高级选项，每行一个参数或空格分隔。注意：重复的 JVM 参数会自动去除">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE943;" />
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard ContentAlignment="Vertical" HorizontalContentAlignment="Stretch" Background="Transparent" BorderThickness="0" Padding="0">
                            <TextBox Text="{x:Bind ViewModel.GlobalCustomJvmArguments, Mode=TwoWay}"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     MinHeight="80"
                                     MaxHeight="200"
                                     HorizontalAlignment="Stretch"
                                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                                     PlaceholderText="-XX:+UseG1GC&#x0a;-Dsun.rmi.dgc.server.gcInterval=2147483646" />
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <!-- 版本隔离 -->
                <controls:SettingsCard x:Uid="Settings_VersionIsolation" Header="启用版本隔离" Description="开启后，每个Minecraft版本将使用独立的游戏目录">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE74C;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch IsOn="{x:Bind ViewModel.EnableVersionIsolation, Mode=TwoWay}" />
                </controls:SettingsCard>

                <!-- 全局内存分配 -->
                <controls:SettingsExpander x:Uid="Settings_GlobalMemory" Header="全局内存分配" Description="设置所有版本的默认内存分配，版本可单独覆盖">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xEEA0;" />
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Content>
                        <ToggleSwitch x:Uid="Settings_GlobalAutoMemory" IsOn="{x:Bind ViewModel.GlobalAutoMemoryAllocation, Mode=TwoWay}" />
                    </controls:SettingsExpander.Content>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard x:Uid="Settings_GlobalInitialHeap" Header="初始堆内存" Description="游戏启动时分配的初始内存（GB）">
                            <NumberBox Value="{x:Bind ViewModel.GlobalInitialHeapMemory, Mode=TwoWay}" Minimum="1" Maximum="64" SpinButtonPlacementMode="Compact" SmallChange="0.5" Width="120"
                                       IsEnabled="{x:Bind ViewModel.GlobalAutoMemoryAllocation, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}" />
                        </controls:SettingsCard>
                        <controls:SettingsCard x:Uid="Settings_GlobalMaxHeap" Header="最大堆内存" Description="游戏运行时允许使用的最大内存（GB）">
                            <NumberBox Value="{x:Bind ViewModel.GlobalMaximumHeapMemory, Mode=TwoWay}" Minimum="1" Maximum="64" SpinButtonPlacementMode="Compact" SmallChange="0.5" Width="120"
                                       IsEnabled="{x:Bind ViewModel.GlobalAutoMemoryAllocation, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}" />
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <!-- 全局启动分辨率 -->
                <controls:SettingsExpander x:Uid="Settings_GlobalResolution" Header="全局启动分辨率" Description="设置所有版本的默认启动窗口大小，版本可单独覆盖">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE740;" />
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard x:Uid="Settings_GlobalWindowWidth" Header="窗口宽度">
                            <NumberBox Value="{x:Bind ViewModel.GlobalWindowWidth, Mode=TwoWay}" Minimum="800" Maximum="4096" SpinButtonPlacementMode="Compact" SmallChange="1" Width="120" />
                        </controls:SettingsCard>
                        <controls:SettingsCard x:Uid="Settings_GlobalWindowHeight" Header="窗口高度">
                            <NumberBox Value="{x:Bind ViewModel.GlobalWindowHeight, Mode=TwoWay}" Minimum="600" Maximum="2160" SpinButtonPlacementMode="Compact" SmallChange="1" Width="120" />
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <!-- 实时日志 -->
                <controls:SettingsCard x:Uid="Settings_RealTimeLogs" Header="启动游戏实时日志" Description="开启后，启动游戏成功后会自动打开实时日志页面">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE756;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch IsOn="{x:Bind ViewModel.EnableRealTimeLogs, Mode=TwoWay}" />
                </controls:SettingsCard>

                <!-- ==================== 个性化 ==================== -->
                <TextBlock x:Uid="Settings_PersonalizationSection" Text="个性化" Style="{ThemeResource BodyStrongTextBlockStyle}" Margin="0,24,0,4" />

                <!-- 主题 -->
                <controls:SettingsCard x:Uid="Settings_Theme" Header="主题" Description="选择应用的外观主题">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE790;" />
                    </controls:SettingsCard.HeaderIcon>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <RadioButton x:Uid="Settings_Theme_Light" Content="浅色" IsChecked="{x:Bind ViewModel.ElementTheme, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Light, Mode=OneWay}"
                                     Command="{x:Bind ViewModel.SwitchThemeCommand}" GroupName="Theme">
                            <RadioButton.CommandParameter><xaml:ElementTheme>Light</xaml:ElementTheme></RadioButton.CommandParameter>
                        </RadioButton>
                        <RadioButton x:Uid="Settings_Theme_Dark" Content="深色" IsChecked="{x:Bind ViewModel.ElementTheme, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Dark, Mode=OneWay}"
                                     Command="{x:Bind ViewModel.SwitchThemeCommand}" GroupName="Theme">
                            <RadioButton.CommandParameter><xaml:ElementTheme>Dark</xaml:ElementTheme></RadioButton.CommandParameter>
                        </RadioButton>
                        <RadioButton x:Uid="Settings_Theme_Default" Content="跟随系统" IsChecked="{x:Bind ViewModel.ElementTheme, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Default, Mode=OneWay}"
                                     Command="{x:Bind ViewModel.SwitchThemeCommand}" GroupName="Theme">
                            <RadioButton.CommandParameter><xaml:ElementTheme>Default</xaml:ElementTheme></RadioButton.CommandParameter>
                        </RadioButton>
                    </StackPanel>
                </controls:SettingsCard>

                <!-- 窗口材质 -->
                <controls:SettingsExpander x:Uid="Settings_WindowMaterial" Header="窗口材质" Description="选择窗口背景效果">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE771;" />
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Content>
                        <ComboBox ItemsSource="{x:Bind ViewModel.MaterialTypes, Mode=OneWay}" SelectedItem="{x:Bind ViewModel.MaterialType, Mode=TwoWay}" MinWidth="200">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={StaticResource MaterialTypeToLocalizedStringConverter}}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </controls:SettingsExpander.Content>
                    <controls:SettingsExpander.Items>
                        <!-- 自定义背景图片 -->
                        <controls:SettingsCard x:Uid="Settings_BackgroundImage" Header="背景图片" Description="选择自定义背景图片"
                                               Visibility="{x:Bind ViewModel.IsCustomBackground, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBox Text="{x:Bind ViewModel.BackgroundImagePath, Mode=TwoWay}" PlaceholderText="请选择背景图片" Width="250" IsReadOnly="True" />
                                <Button Content="浏览..." Command="{x:Bind ViewModel.BrowseBackgroundImageCommand}" />
                                <Button Content="清除" Command="{x:Bind ViewModel.ClearBackgroundImageCommand}" />
                            </StackPanel>
                        </controls:SettingsCard>
                        <!-- 流光设置 -->
                        <controls:SettingsCard Header="流光速度" Description="调整流光背景的移动速度"
                                               Visibility="{x:Bind ViewModel.IsMotionBackground, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Slider Minimum="0.1" Maximum="3.0" StepFrequency="0.1" Value="{x:Bind ViewModel.MotionSpeed, Mode=TwoWay}" Width="200" />
                        </controls:SettingsCard>
                        <controls:SettingsCard Header="流光颜色" Description="自定义流光背景的颜色"
                                               Visibility="{x:Bind ViewModel.IsMotionBackground, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Button Width="36" Height="36" CornerRadius="18" Padding="0" BorderThickness="2" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                                    <Border Background="{x:Bind ViewModel.MotionColor1, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}" CornerRadius="16" Width="28" Height="28" />
                                    <Button.Flyout><Flyout><ColorPicker Color="{x:Bind ViewModel.MotionColor1, Mode=TwoWay}" IsMoreButtonVisible="False" IsColorSliderVisible="True" /></Flyout></Button.Flyout>
                                </Button>
                                <Button Width="36" Height="36" CornerRadius="18" Padding="0" BorderThickness="2" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                                    <Border Background="{x:Bind ViewModel.MotionColor2, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}" CornerRadius="16" Width="28" Height="28" />
                                    <Button.Flyout><Flyout><ColorPicker Color="{x:Bind ViewModel.MotionColor2, Mode=TwoWay}" IsMoreButtonVisible="False" IsColorSliderVisible="True" /></Flyout></Button.Flyout>
                                </Button>
                                <Button Width="36" Height="36" CornerRadius="18" Padding="0" BorderThickness="2" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                                    <Border Background="{x:Bind ViewModel.MotionColor3, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}" CornerRadius="16" Width="28" Height="28" />
                                    <Button.Flyout><Flyout><ColorPicker Color="{x:Bind ViewModel.MotionColor3, Mode=TwoWay}" IsMoreButtonVisible="False" IsColorSliderVisible="True" /></Flyout></Button.Flyout>
                                </Button>
                                <Button Width="36" Height="36" CornerRadius="18" Padding="0" BorderThickness="2" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                                    <Border Background="{x:Bind ViewModel.MotionColor4, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}" CornerRadius="16" Width="28" Height="28" />
                                    <Button.Flyout><Flyout><ColorPicker Color="{x:Bind ViewModel.MotionColor4, Mode=TwoWay}" IsMoreButtonVisible="False" IsColorSliderVisible="True" /></Flyout></Button.Flyout>
                                </Button>
                                <Button Width="36" Height="36" CornerRadius="18" Padding="0" BorderThickness="2" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                                    <Border Background="{x:Bind ViewModel.MotionColor5, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}" CornerRadius="16" Width="28" Height="28" />
                                    <Button.Flyout><Flyout><ColorPicker Color="{x:Bind ViewModel.MotionColor5, Mode=TwoWay}" IsMoreButtonVisible="False" IsColorSliderVisible="True" /></Flyout></Button.Flyout>
                                </Button>
                            </StackPanel>
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <!-- 语言 -->
                <controls:SettingsCard x:Uid="Settings_Language" Header="语言" Description="选择应用语言，更改后需要重启应用">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE774;" />
                    </controls:SettingsCard.HeaderIcon>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <RadioButton x:Uid="Settings_Language_Chinese" Content="简体中文" IsChecked="{x:Bind ViewModel.Language, Converter={StaticResource StringToBooleanConverter}, ConverterParameter=zh-CN, Mode=OneWay}"
                                     Command="{x:Bind ViewModel.SwitchLanguageCommand}" CommandParameter="zh-CN" GroupName="Language" />
                        <RadioButton x:Uid="Settings_Language_English" Content="English" IsChecked="{x:Bind ViewModel.Language, Converter={StaticResource StringToBooleanConverter}, ConverterParameter=en-US, Mode=OneWay}"
                                     Command="{x:Bind ViewModel.SwitchLanguageCommand}" CommandParameter="en-US" GroupName="Language" />
                    </StackPanel>
                </controls:SettingsCard>

                <!-- 字体 -->
                <controls:SettingsCard x:Uid="Settings_FontFamily" Header="字体" Description="选择应用字体，更改后立即生效">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE8D2;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ComboBox ItemsSource="{x:Bind ViewModel.FontFamilies, Mode=OneWay}" SelectedItem="{x:Bind ViewModel.SelectedFontFamily, Mode=TwoWay}" MinWidth="200">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" FontFamily="{Binding}" />
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </controls:SettingsCard>


                <!-- ==================== 网络 ==================== -->
                <TextBlock x:Uid="Settings_NetworkSection" Text="网络" Style="{ThemeResource BodyStrongTextBlockStyle}" Margin="0,24,0,4" />

                <!-- 游戏下载源 -->
                <controls:SettingsCard x:Uid="Settings_DownloadSource" Header="游戏下载源" Description="选择下载源可以影响游戏资源的下载速度">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE896;" />
                    </controls:SettingsCard.HeaderIcon>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <RadioButton x:Uid="Settings_DownloadSource_Official" Content="官方源" IsChecked="{x:Bind ViewModel.DownloadSource, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Official, Mode=OneWay}"
                                     Command="{x:Bind ViewModel.SwitchDownloadSourceCommand}" CommandParameter="Official" GroupName="DownloadSource" />
                        <RadioButton x:Uid="Settings_DownloadSource_BMCLAPI" Content="BMCLAPI" IsChecked="{x:Bind ViewModel.DownloadSource, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=BMCLAPI, Mode=OneWay}"
                                     Command="{x:Bind ViewModel.SwitchDownloadSourceCommand}" CommandParameter="BMCLAPI" GroupName="DownloadSource" />
                    </StackPanel>
                </controls:SettingsCard>

                <!-- 版本列表源 -->
                <controls:SettingsCard x:Uid="Settings_SelectVersionListSource" Header="版本列表源" Description="选择版本列表源可以影响版本列表的获取速度">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE8FD;" />
                    </controls:SettingsCard.HeaderIcon>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <RadioButton x:Uid="Settings_VersionListSource_Official" Content="官方源" IsChecked="{x:Bind ViewModel.VersionListSource, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Official, Mode=OneWay}"
                                     Command="{x:Bind ViewModel.SwitchVersionListSourceCommand}" CommandParameter="Official" GroupName="VersionListSource" />
                        <RadioButton x:Uid="Settings_VersionListSource_BMCLAPI" Content="BMCLAPI" IsChecked="{x:Bind ViewModel.VersionListSource, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=BMCLAPI, Mode=OneWay}"
                                     Command="{x:Bind ViewModel.SwitchVersionListSourceCommand}" CommandParameter="BMCLAPI" GroupName="VersionListSource" />
                    </StackPanel>
                </controls:SettingsCard>

                <!-- 社区资源下载源 -->
                <controls:SettingsCard x:Uid="Settings_SelectCommunityDownloadSource" Header="社区资源下载源" Description="选择Modrinth和CurseForge资源的下载源">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE753;" />
                    </controls:SettingsCard.HeaderIcon>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <RadioButton x:Uid="Settings_CommunityDownloadSource_Official" Content="官方源" IsChecked="{x:Bind ViewModel.ModrinthDownloadSource, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Official, Mode=OneWay}"
                                     Command="{x:Bind ViewModel.SwitchModrinthDownloadSourceCommand}" CommandParameter="Official" GroupName="ModrinthSource" />
                        <RadioButton x:Uid="Settings_CommunityDownloadSource_MCIM" Content="MCIM镜像" IsChecked="{x:Bind ViewModel.ModrinthDownloadSource, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=MCIM, Mode=OneWay}"
                                     Command="{x:Bind ViewModel.SwitchModrinthDownloadSourceCommand}" CommandParameter="MCIM" GroupName="ModrinthSource" />
                    </StackPanel>
                </controls:SettingsCard>

                <!-- 下载前置Mod -->
                <controls:SettingsCard x:Uid="Settings_DownloadDependencies" Header="下载前置Mod" Description="自动下载所需的前置Mod">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE74E;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch IsOn="{x:Bind ViewModel.DownloadDependencies, Mode=TwoWay}" />
                </controls:SettingsCard>

                <!-- 隐藏快照版本 -->
                <controls:SettingsCard x:Uid="Settings_HideSnapshotVersions" Header="Mod隐藏快照版本" Description="隐藏Mod下载页快照、预发布版和候选版本">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE7B3;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch IsOn="{x:Bind ViewModel.HideSnapshotVersions, Mode=TwoWay}" />
                </controls:SettingsCard>

                <!-- 下载线程数 -->
                <controls:SettingsCard x:Uid="Settings_DownloadThreadCount" Header="下载线程数" Description="同时下载资源文件的数量，数值越大下载越快">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE8CB;" />
                    </controls:SettingsCard.HeaderIcon>
                    <NumberBox Value="{x:Bind ViewModel.DownloadThreadCount, Mode=TwoWay}" Minimum="1" Maximum="128" SpinButtonPlacementMode="Compact" SmallChange="1" LargeChange="8" Width="120" />
                </controls:SettingsCard>

                <!-- 下载分片数 -->
                <controls:SettingsCard x:Uid="Settings_DownloadShardCount" Header="核心文件分片数" Description="单个大文件的分片并发下载数量">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE8CB;" />
                    </controls:SettingsCard.HeaderIcon>
                    <NumberBox Value="{x:Bind ViewModel.DownloadShardCount, Mode=TwoWay}" Minimum="1" Maximum="32" SpinButtonPlacementMode="Compact" SmallChange="1" LargeChange="4" Width="120" />
                </controls:SettingsCard>

                <!-- 缓存管理 -->
                <controls:SettingsExpander x:Uid="Settings_CacheManagement" Header="缓存管理" Description="管理搜索结果和图片缓存">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE74D;" />
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Content>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <Button x:Uid="Settings_ClearAllCache" Content="清理所有缓存" Command="{x:Bind ViewModel.ClearAllCacheCommand}" />
                            <Button x:Uid="Settings_ClearImageCache" Content="清理图片缓存" Command="{x:Bind ViewModel.ClearImageCacheCommand}" />
                            <ProgressRing IsActive="{x:Bind ViewModel.IsClearingCache, Mode=OneWay}" Width="20" Height="20" />
                        </StackPanel>
                    </controls:SettingsExpander.Content>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard x:Uid="Settings_TotalCacheSize" Header="总缓存大小">
                            <TextBlock Text="{x:Bind ViewModel.CacheSizeInfo.TotalSizeFormatted, Mode=OneWay}" FontWeight="SemiBold" />
                        </controls:SettingsCard>
                        <controls:SettingsCard x:Uid="Settings_SearchCacheSize" Header="搜索结果缓存">
                            <TextBlock Text="{x:Bind ViewModel.CacheSizeInfo.SearchCacheSizeFormatted, Mode=OneWay}" Opacity="0.7" />
                        </controls:SettingsCard>
                        <controls:SettingsCard x:Uid="Settings_ImageCacheSize" Header="图片缓存">
                            <TextBlock Text="{x:Bind ViewModel.CacheSizeInfo.ImageCacheSizeFormatted, Mode=OneWay}" Opacity="0.7" />
                        </controls:SettingsCard>
                        <controls:SettingsCard x:Uid="Settings_VersionCacheSize" Header="版本列表缓存">
                            <TextBlock Text="{x:Bind ViewModel.CacheSizeInfo.VersionCacheSizeFormatted, Mode=OneWay}" Opacity="0.7" />
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <!-- ==================== AI 分析 ==================== -->
                <TextBlock x:Uid="Settings_AISection" Text="AI 分析" Style="{ThemeResource BodyStrongTextBlockStyle}" Margin="0,24,0,4" />

                <!-- AI 分析设置 -->
                <controls:SettingsExpander x:Uid="Settings_AI_CrashAnalysis" Header="AI 崩溃分析" Description="启用后可使用第三方 AI 服务分析崩溃日志" IsExpanded="{x:Bind ViewModel.IsAIAnalysisEnabled, Mode=OneWay}">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE945;" />
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Content>
                        <ToggleSwitch IsOn="{x:Bind ViewModel.IsAIAnalysisEnabled, Mode=TwoWay}" />
                    </controls:SettingsExpander.Content>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard ContentAlignment="Vertical" HorizontalContentAlignment="Stretch" Visibility="{x:Bind ViewModel.IsAIAnalysisEnabled, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock x:Uid="Settings_AI_Disclaimer" Text="XianYuFixer 仅提供接入 OpenAI API 规范的 LLM 的能力，软件内不提供任何 AI 服务或账号。使用前请确认您所在地区允许使用相关服务。"
                                       Style="{ThemeResource CaptionTextBlockStyle}" TextWrapping="Wrap" Opacity="0.7" Margin="0,0,0,8" />
                        </controls:SettingsCard>
                        <controls:SettingsCard x:Uid="Settings_AI_ApiEndpoint" Header="API 端点" Description="OpenAI 兼容的 API 基础 URL"
                                               Visibility="{x:Bind ViewModel.IsAIAnalysisEnabled, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBox Text="{x:Bind ViewModel.AiApiEndpoint, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="https://api.openai.com" Width="300" />
                        </controls:SettingsCard>
                        <controls:SettingsCard x:Uid="Settings_AI_ApiKey" Header="API 密钥" Description="您的 API 密钥"
                                               Visibility="{x:Bind ViewModel.IsAIAnalysisEnabled, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <PasswordBox Password="{x:Bind ViewModel.AiApiKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="sk-..." Width="300" />
                        </controls:SettingsCard>
                        <controls:SettingsCard x:Uid="Settings_AI_ModelName" Header="模型名称" Description="使用的 AI 模型"
                                               Visibility="{x:Bind ViewModel.IsAIAnalysisEnabled, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBox Text="{x:Bind ViewModel.AiModel, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="gpt-3.5-turbo" Width="300" />
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>


                <!-- ==================== 关于 ==================== -->
                <TextBlock x:Uid="Settings_AboutSection" Text="关于" Style="{ThemeResource BodyStrongTextBlockStyle}" Margin="0,24,0,4" />

                <!-- 开发者信息 -->
                <controls:SettingsCard x:Uid="Settings_ContributorsHeader" Header="SpiritStudio" Description="感谢所有作出贡献的成员" IsClickEnabled="False">
                    <controls:SettingsCard.HeaderIcon>
                        <ImageIcon Source="ms-appx:///Assets/Icons/Contributors/SpiritStudio.png" />
                    </controls:SettingsCard.HeaderIcon>
                </controls:SettingsCard>

                <!-- 鸣谢 -->
                <controls:SettingsExpander x:Uid="Settings_Acknowledgments" Header="鸣谢" Description="感谢以下项目和贡献者">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE8D4;" />
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard ContentAlignment="Vertical" HorizontalContentAlignment="Stretch">
                            <ItemsControl ItemsSource="{x:Bind ViewModel.AcknowledgmentPersons, Mode=OneWay}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="16" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="viewModels:AcknowledgmentPerson">
                                        <StackPanel Width="88" HorizontalAlignment="Center">
                                            <Ellipse Width="40" Height="40" HorizontalAlignment="Center" Margin="0,0,0,8">
                                                <Ellipse.Fill>
                                                    <ImageBrush ImageSource="{x:Bind Avatar, Mode=OneWay}" Stretch="Uniform" />
                                                </Ellipse.Fill>
                                            </Ellipse>
                                            <TextBlock Text="{x:Bind Name, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" FontSize="12" HorizontalAlignment="Center" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" Margin="0,0,0,2" />
                                            <TextBlock Text="{x:Bind SupportInfo, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" FontSize="10" HorizontalAlignment="Center" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" Opacity="0.5" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <!-- 版本信息 -->
                <controls:SettingsCard x:Uid="Settings_About" Header="关于" IsClickEnabled="False">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE946;" />
                    </controls:SettingsCard.HeaderIcon>
                    <controls:SettingsCard.Description>
                        <StackPanel>
                            <TextBlock Text="{x:Bind ViewModel.VersionDescription, Mode=OneWay}" PointerPressed="VersionTextBlock_PointerPressed" />
                            <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                                <HyperlinkButton x:Uid="SettingsPage_EulaLink" Padding="0" />
                                <HyperlinkButton x:Uid="SettingsPage_PrivacyPolicyLink" Padding="0" />
                                <HyperlinkButton Content="GitHub" NavigateUri="https://github.com/XianYuLauncher/XianYuLauncher" Padding="0" />
                                <HyperlinkButton x:Uid="SettingsPage_AfdianLink" NavigateUri="https://afdian.com/a/SpiritStudio" Padding="0" />
                            </StackPanel>
                        </StackPanel>
                    </controls:SettingsCard.Description>
                </controls:SettingsCard>

                <!-- 遥测 -->
                <controls:SettingsCard x:Uid="Settings_Telemetry" Header="允许发送匿名诊断数据" Description="帮助改进启动器，仅收集游戏版本、运行性能及启动结果类数据">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE9D9;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch IsOn="{x:Bind ViewModel.EnableTelemetry, Mode=TwoWay}" />
                </controls:SettingsCard>

                <!-- 更新设置 -->
                <controls:SettingsExpander x:Uid="Settings_UpdateSettings" Header="更新设置" Description="配置自动检查更新的方式">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE777;" />
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Content>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <Button x:Uid="Settings_CheckForUpdates" Content="检查更新" Command="{x:Bind ViewModel.CheckForUpdatesCommand}"
                                    IsEnabled="{x:Bind ViewModel.IsCheckingForUpdates, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}" />
                            <Button x:Uid="Settings_InstallDevChannel" Content="安装 Dev 通道版本" Command="{x:Bind ViewModel.InstallDevChannelCommand}"
                                    IsEnabled="{x:Bind ViewModel.CanInstallDevChannel, Mode=OneWay}" />
                            <ProgressRing IsActive="{x:Bind ViewModel.IsCheckingForUpdates, Mode=OneWay}" Width="20" Height="20" />
                        </StackPanel>
                    </controls:SettingsExpander.Content>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard x:Uid="Settings_AutoUpdateCheck" Header="自动检查更新">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <RadioButton x:Uid="Settings_AutoUpdateCheck_Always" Content="每次启动弹窗" IsChecked="{x:Bind ViewModel.AutoUpdateCheckMode, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Always, Mode=OneWay}"
                                             Command="{x:Bind ViewModel.SwitchAutoUpdateCheckModeCommand}" CommandParameter="Always" GroupName="UpdateMode" />
                                <RadioButton x:Uid="Settings_AutoUpdateCheck_ImportantOnly" Content="仅重要更新" IsChecked="{x:Bind ViewModel.AutoUpdateCheckMode, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=ImportantOnly, Mode=OneWay}"
                                             Command="{x:Bind ViewModel.SwitchAutoUpdateCheckModeCommand}" CommandParameter="ImportantOnly" GroupName="UpdateMode" />
                            </StackPanel>
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <!-- 快速动作 -->
                <controls:SettingsCard x:Uid="Settings_OpenLogDirectory" Header="打开日志目录" Description="查看启动器运行日志，用于排查问题" IsClickEnabled="True" Click="OpenLogDirectory_Click">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE8B7;" />
                    </controls:SettingsCard.HeaderIcon>
                    <controls:SettingsCard.ActionIcon>
                        <FontIcon Glyph="&#xE8A7;" />
                    </controls:SettingsCard.ActionIcon>
                </controls:SettingsCard>

                <!-- 开源软件许可 -->
                <controls:SettingsExpander x:Uid="Settings_OpenSourceTitle" Header="开源软件许可说明" Description="本项目使用的开源软件">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE90F;" />
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard Header="authlib-injector" Description="Copyright (c) yushijinhun | AGPL-3.0 | 已遵循AGPL例外条款" IsClickEnabled="True" Click="OpenSourceLink_Click" Tag="https://github.com/yushijinhun/authlib-injector" />
                        <controls:SettingsCard Header="Terracotta | 陶瓦联机" Description="Copyright (c) burningtnt | AGPL-3.0 | 已遵循AGPL例外条款" IsClickEnabled="True" Click="OpenSourceLink_Click" Tag="https://github.com/burningtnt/Terracotta" />
                        <controls:SettingsCard Header="skinview3d" Description="Copyright (c) Kent Rasmussen, Haowei Wen | MIT" IsClickEnabled="True" Click="OpenSourceLink_Click" Tag="https://github.com/bs-community/skinview3d" />
                        <controls:SettingsCard Header="Newtonsoft.Json" Description="Copyright (c) James Newton-King | MIT" IsClickEnabled="True" Click="OpenSourceLink_Click" Tag="https://www.newtonsoft.com/json" />
                        <controls:SettingsCard Header="CommunityToolkit" Description="Copyright (c) .NET Foundation | MIT" IsClickEnabled="True" Click="OpenSourceLink_Click" Tag="https://aka.ms/CommunityToolkit" />
                        <controls:SettingsCard Header="Serilog" Description="Copyright (c) Serilog Contributors | Apache-2.0" IsClickEnabled="True" Click="OpenSourceLink_Click" Tag="https://github.com/serilog/serilog" />
                        <controls:SettingsCard Header="WinUIEx" Description="Copyright (c) Morten Nielsen | MIT" IsClickEnabled="True" Click="OpenSourceLink_Click" Tag="https://github.com/dotMorten/WinUIEx" />
                        <controls:SettingsCard Header="fNbt" Description="Copyright (c) Matvei Stefarov | BSD-3-Clause" IsClickEnabled="True" Click="OpenSourceLink_Click" Tag="https://github.com/mstefarov/fNbt" />
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <!-- 免责声明 -->
                <TextBlock x:Uid="Settings_Disclaimer" Text="XianYuLauncher 是一个非官方的 Minecraft 启动器，与 Mojang Studios、Microsoft 及其中国大陆代理公司无任何从属关系或官方合作关联。"
                           Style="{ThemeResource CaptionTextBlockStyle}" Margin="0,16,0,20" Opacity="0.7" TextWrapping="WrapWholeWords" />

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
