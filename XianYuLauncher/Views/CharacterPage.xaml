<Page
    x:Class="XianYuLauncher.Views.CharacterPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="using:XianYuLauncher.ViewModels"
    xmlns:helpers="using:XianYuLauncher.Helpers"
    mc:Ignorable="d">
    
    <Page.Resources>
        <!-- 使用系统默认按钮样式，与设置页面保持一致 -->
        <Style x:Key="CustomPrimaryButtonStyle" TargetType="Button">
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Height" Value="44" />
            <Setter Property="Padding" Value="16,10" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
        </Style>
        
        <!-- 角色卡片样式 -->
        <Style x:Key="ProfileCardStyle" TargetType="Border">
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}" />
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="24" />
            <Setter Property="Margin" Value="0,0,0,16" />
        </Style>
        
        <!-- 圆形按钮样式 -->
        <Style x:Key="ProfileButtonStyle" TargetType="Button">
            <Setter Property="Height" Value="36" />
            <Setter Property="Width" Value="36" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="CornerRadius" Value="18" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}" />
            <Setter Property="Foreground" Value="{ThemeResource SystemControlForegroundBaseHighBrush}" />
        </Style>
    </Page.Resources>

    <Grid x:Name="ContentArea" Padding="24,48,24,24" DataContext="{x:Bind ViewModel}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- 标题区域 -->
            <StackPanel Grid.Row="0" Margin="0,0,0,32">
                <TextBlock 
                    x:Uid="ProfilePage_Title" 
                    Text="角色管理" 
                    Style="{StaticResource TitleTextBlockStyle}" 
                    FontSize="40" 
                    FontWeight="Bold" 
                    Margin="0,0,0,8" />
                <TextBlock 
                    x:Uid="ProfilePage_Subtitle" 
                    Text="管理您的Minecraft角色" 
                    Style="{StaticResource SubtitleTextBlockStyle}" 
                    Opacity="0.7" />
            </StackPanel>

            <!-- 登录状态显示 -->
            <StackPanel 
                Grid.Row="1" 
                Visibility="{x:Bind ViewModel.IsLoggingIn, Mode=OneWay}" 
                Margin="0,0,0,24" 
                Orientation="Horizontal" 
                Spacing="12" 
                VerticalAlignment="Center">
                <ProgressRing 
                    IsActive="{x:Bind ViewModel.IsLoggingIn, Mode=OneWay}" 
                    Width="20" 
                    Height="20" 
                    Foreground="{ThemeResource SystemControlHighlightAccentBrush}" />
                <TextBlock 
                    Text="{x:Bind ViewModel.LoginStatus, Mode=OneWay}" 
                    Style="{StaticResource BodyTextBlockStyle}" 
                    Foreground="{ThemeResource SystemControlHighlightAccentBrush}" 
                    TextWrapping="WrapWholeWords" />
            </StackPanel>

            <!-- 主要内容区域 -->
        <ScrollViewer 
            Grid.Row="2" 
            VerticalScrollBarVisibility="Auto" 
            HorizontalScrollBarVisibility="Disabled">
            <StackPanel Spacing="32" HorizontalAlignment="Stretch" VerticalAlignment="Top">
                <!-- 角色列表 -->
                <StackPanel Spacing="16" HorizontalAlignment="Stretch">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock 
                            x:Uid="ProfilePage_AddedProfilesText" 
                            Text="已添加的角色" 
                            Style="{StaticResource TitleTextBlockStyle}" 
                            FontSize="20" 
                            FontWeight="SemiBold" 
                            VerticalAlignment="Center" 
                            HorizontalAlignment="Left" />
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right">
                            <Button 
                                    x:Uid="ProfilePage_AddAccountButton" 
                                    Style="{StaticResource CustomPrimaryButtonStyle}" 
                                    ToolTipService.ToolTip="添加账户"
                                    HorizontalAlignment="Right">
                                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                        <FontIcon 
                                            FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                            Glyph="&#xE109;" 
                                            FontSize="16" /> 
                                        <TextBlock x:Uid="ProfilePage_AddAccountText" Text="添加账户" FontSize="14" VerticalAlignment="Center" /> 
                                    </StackPanel>
                                    <Button.Flyout>
                                        <MenuFlyout>
                                            <MenuFlyoutItem 
                                                x:Uid="ProfilePage_OfflineLoginMenuItem"
                                                x:Name="OfflineLoginMenuItem"
                                                Text="离线登录" 
                                                Click="OfflineLoginMenuItem_Click"
                                                Tag="offline">
                                                <MenuFlyoutItem.Icon>
                                                    <SymbolIcon Symbol="Add" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutItem 
                                                x:Uid="ProfilePage_MicrosoftLoginMenuItem"
                                                x:Name="MicrosoftLoginMenuItem"
                                                Text="微软登录" 
                                                Click="MicrosoftLoginMenuItem_Click"
                                                Tag="microsoft">
                                                <MenuFlyoutItem.Icon>
                                                    <SymbolIcon Symbol="Contact" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutItem 
                                                x:Uid="ProfilePage_ExternalLoginMenuItem"
                                                x:Name="ExternalLoginMenuItem"
                                                Text="外置登录" 
                                                Click="ExternalLoginMenuItem_Click"
                                                Tag="external">
                                                <MenuFlyoutItem.Icon>
                                                    <SymbolIcon Symbol="World" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                        </MenuFlyout>
                                    </Button.Flyout>
                                </Button>
                        </StackPanel>
                    </Grid>

                    <!-- 角色卡片列表 -->
                    <ItemsControl x:Name="ProfileCardList" ItemsSource="{x:Bind ViewModel.Profiles, Mode=OneWay}" Margin="0,16,0,0" HorizontalAlignment="Stretch">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="viewModels:MinecraftProfile">
                                <Grid HorizontalAlignment="Stretch">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- 角色卡片 -->
                                    <Border 
                                        x:Name="ProfileCard"
                                        Grid.Column="0"
                                        Style="{StaticResource ProfileCardStyle}"
                                        Tapped="ProfileCard_Tapped" 
                                        Tag="{Binding}"
                                        HorizontalAlignment="Stretch">
                                        <!-- 角色信息 -->
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Spacing="16" Grid.Column="0">
                                                <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                                                <!-- 玩家头像 -->
                                                <Border 
                                                    Width="48" 
                                                    Height="48" 
                                                    CornerRadius="24" 
                                                    Background="#E5E7EB" 
                                                    VerticalAlignment="Center" 
                                                    HorizontalAlignment="Center">
                                                    <Image 
                                                        x:Name="ProfileAvatar" 
                                                        Width="48" 
                                                        Height="48" 
                                                        Source="ms-appx:///Assets/DefaultAvatar.png" 
                                                        Stretch="Fill" 
                                                        HorizontalAlignment="Center" 
                                                        VerticalAlignment="Center" 
                                                        Tag="{Binding}" />
                                                </Border>
                                                
                                                <TextBlock 
                                                    Text="{x:Bind Name}" 
                                                    Style="{StaticResource TitleTextBlockStyle}" 
                                                    FontSize="22" 
                                                    FontWeight="SemiBold" 
                                                    VerticalAlignment="Center" 
                                                    Margin="0,4,0,4" />
                                                </StackPanel>
                                                
                                                <!-- 详细信息 -->
                                                <StackPanel Spacing="8" Margin="0,8,0,0">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <TextBlock 
                                                            x:Uid="ProfilePage_UuidLabel" 
                                                            Text="UUID: " 
                                                            FontSize="14" 
                                                            Opacity="0.6" />
                                                        <TextBlock 
                                                            Text="{x:Bind Id}" 
                                                            FontSize="14" 
                                                            Opacity="0.6" 
                                                            FontWeight="SemiBold" />
                                                    </StackPanel>
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <TextBlock 
                                                            x:Uid="ProfilePage_ProfileTypeLabel" 
                                                            Text="角色类型: " 
                                                            FontSize="14" 
                                                            Opacity="0.6" />
                                                        <TextBlock 
                                                            x:Uid="ProfilePage_ProfileTypeValue" 
                                                            Text="{x:Bind Mode=OneWay, Converter={StaticResource ProfileTypeConverter}}" 
                                                            FontSize="14" 
                                                            Opacity="0.6" 
                                                            FontWeight="SemiBold" />
                                                    </StackPanel>
                                                </StackPanel>
                                            </StackPanel>
                                            
                                            <!-- 按钮区域 -->
                                            <StackPanel Grid.Column="1" Orientation="Vertical" Spacing="8" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,0,0">
                                                <!-- 切换角色按钮 -->
                                                <Button 
                                                    x:Uid="ProfilePage_SwitchProfileButton"
                                                    Command="{Binding DataContext.SwitchProfileCommand, ElementName=ContentArea}"
                                                    CommandParameter="{Binding}"
                                                    Style="{StaticResource ProfileButtonStyle}"
                                                    ToolTipService.ToolTip="切换到该角色">
                                                    <FontIcon 
                                                        FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                                        Glyph="&#xE72D;" 
                                                        FontSize="16" 
                                                        Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}" />
                                                </Button>
                                                
                                                <!-- 删除角色按钮 -->
                                                <Button 
                                                    x:Uid="ProfilePage_DeleteProfileButton"
                                                    Command="{Binding DataContext.DeleteProfileCommand, ElementName=ContentArea}"
                                                    CommandParameter="{Binding}"
                                                    Style="{StaticResource ProfileButtonStyle}"
                                                    ToolTipService.ToolTip="删除角色">
                                                    <FontIcon 
                                                        FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                                        Glyph="&#xE107;" 
                                                        FontSize="16" 
                                                        Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}" />
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- 空角色列表提示 -->
                    <StackPanel 
                        x:Uid="ProfilePage_EmptyProfilesStack" 
                        Visibility="{x:Bind ViewModel.IsProfilesEmpty, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                        Orientation="Vertical" 
                        VerticalAlignment="Center" 
                        HorizontalAlignment="Center"
                        Spacing="20"
                        Margin="0,80,0,0" 
                        Padding="40,20,40,20">
                        <FontIcon 
                            FontFamily="{StaticResource SymbolThemeFontFamily}" 
                            Glyph="&#xE118;" 
                            FontSize="80" 
                            Opacity="0.2" 
                            Margin="0,0,0,8" />
                        <TextBlock 
                            x:Uid="ProfilePage_EmptyProfilesTitle" 
                            Text="还没有添加任何角色" 
                            FontSize="20" 
                            FontWeight="SemiBold" 
                            Opacity="0.7" 
                            TextAlignment="Center" 
                            Margin="0,0,0,4" />
                        <TextBlock 
                            x:Uid="ProfilePage_EmptyProfilesDescription" 
                            Text="点击'添加账户'按钮开始添加您的第一个角色" 
                            FontSize="15" 
                            Opacity="0.6" 
                            TextAlignment="Center" 
                            LineHeight="22" />
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>