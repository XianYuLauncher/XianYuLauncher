<Page
    x:Class="XianYuLauncher.Views.ResourceDownloadPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="using:XianYuLauncher.Helpers"
    xmlns:viewModels="using:XianYuLauncher.ViewModels"
    xmlns:models="using:XianYuLauncher.Core.Models"
    mc:Ignorable="d">

    <Grid x:Name="ContentArea" Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 标题区域 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock x:Name="PageTitle" x:Uid="ResourceDownloadPage_PageTitle" Text="资源下载" Style="{StaticResource PageTitleStyle}" FontSize="36" FontWeight="Bold" />
            <TextBlock x:Name="PageSubtitle" x:Uid="ResourceDownloadPage_PageSubtitle" Text="下载和管理Minecraft资源" Style="{StaticResource BodyTextStyle}" Margin="0,8,0,0" Opacity="0.7" />
        </StackPanel>

        <!-- 主要内容区域 -->
        <Grid Grid.Row="1">
            <!-- TabView控件 -->
            <TabView 
                x:Name="ResourceTabView" 
                HorizontalAlignment="Stretch" 
                VerticalAlignment="Stretch" 
                Height="Auto" 
                SelectedIndex="0"
                SelectionChanged="ResourceTabView_SelectionChanged">
                <TabView.Resources>
                    <Style TargetType="TabViewItem">
                        <Setter Property="IsClosable" Value="False" />
                    </Style>
                </TabView.Resources>
                
                <!-- 版本下载标签 -->
                <TabView.TabItems>
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_VersionTabHeader" Text="版本下载" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!-- 最新版本卡片 -->
                            <Grid Grid.Row="0" Margin="12,10,12,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="10" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!-- 最新正式版 -->
                                <Border CornerRadius="8" Padding="15" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" Background="{ThemeResource CardBackgroundFillColorDefault}" HorizontalAlignment="Stretch">
                                    <StackPanel>
                                        <TextBlock x:Uid="ResourceDownloadPage_LatestRelease" Text="最新正式版" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondary}" />
                                        <TextBlock Text="{Binding LatestReleaseVersion, Mode=OneWay}" Style="{StaticResource TitleTextBlockStyle}" Foreground="{ThemeResource TextFillColorPrimary}" />
                                        <Button x:Uid="ResourceDownloadPage_DownloadButton" Content="下载" Style="{StaticResource DefaultButtonStyle}" HorizontalAlignment="Left" Margin="0,10,0,0"
                                                Command="{Binding DownloadVersionCommand}" CommandParameter="{Binding LatestReleaseVersion, Mode=OneWay}" />
                                    </StackPanel>
                                </Border>

                                <!-- 最新快照版 -->
                                <Border Grid.Column="2" CornerRadius="8" Padding="15" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" Background="{ThemeResource CardBackgroundFillColorDefault}" HorizontalAlignment="Stretch">
                                    <StackPanel>
                                        <TextBlock x:Uid="ResourceDownloadPage_LatestSnapshot" Text="最新快照版" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondary}" />
                                        <TextBlock Text="{Binding LatestSnapshotVersion, Mode=OneWay}" Style="{StaticResource TitleTextBlockStyle}" Foreground="{ThemeResource TextFillColorPrimary}" />
                                        <Button x:Uid="ResourceDownloadPage_DownloadButton" Content="下载" Style="{StaticResource DefaultButtonStyle}" HorizontalAlignment="Left" Margin="0,10,0,0"
                                                Command="{Binding DownloadVersionCommand}" CommandParameter="{Binding LatestSnapshotVersion, Mode=OneWay}" />
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- 搜索和刷新 -->
                            <Grid Grid.Row="1" Margin="12,0,12,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <TextBox 
                                    Grid.Column="0"
                                    x:Name="VersionSearchBox"
                                    x:Uid="ResourceDownloadPage_VersionSearchBox"
                                    PlaceholderText="搜索版本..."
                                    Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                    KeyDown="VersionSearchBox_KeyDown" 
                                    HorizontalAlignment="Stretch" />

                                <Button 
                                    Grid.Column="1"
                                    Margin="10,0,0,0"
                                    Command="{Binding RefreshVersionsCommand}">
                                    <Grid>
                                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xe72c;" Visibility="{Binding IsRefreshing, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}" />
                                        <ProgressRing IsActive="{Binding IsRefreshing, Mode=OneWay}" Width="20" Height="20" Visibility="{Binding IsRefreshing, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                                    </Grid>
                                </Button>
                            </Grid>

                            <!-- 版本列表 -->
                            <Grid Grid.Row="2" Margin="12,0,12,0">
                                <!-- 加载指示器 -->
                                <ProgressRing IsActive="{Binding IsVersionLoading, Mode=OneWay}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                  
                                <!-- 版本列表 -->
                                <ListView 
                                    x:Name="VersionListView"
                                    ItemsSource="{Binding FilteredVersions, Mode=OneWay}"
                                    IsItemClickEnabled="True"
                                    ItemClick="VersionListView_ItemClick"
                                    SelectionMode="None"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Visibility="{Binding IsVersionLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}"
                                    ShowsScrollingPlaceholders="True">
                                    <ListView.Resources>
                                        <Style TargetType="ScrollViewer">
                                            <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                                            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
                                            <Setter Property="IsScrollInertiaEnabled" Value="True"/>
                                            <Setter Property="ScrollViewer.VerticalScrollMode" Value="Enabled"/>
                                            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
                                        </Style>
                                    </ListView.Resources>
                                    <ListView.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <!-- 使用ItemsStackPanel替代VirtualizingStackPanel，提供更好的平滑滚动支持 -->
                                            <!-- ItemsStackPanel默认启用虚拟化，不需要设置VirtualizationMode属性 -->
                                            <ItemsStackPanel/>
                                        </ItemsPanelTemplate>
                                    </ListView.ItemsPanel>
                                    <ListView.ItemContainerStyle>
                                        <Style TargetType="ListViewItem">
                                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                            <Setter Property="Margin" Value="0,0,0,10" />
                                            <Setter Property="Padding" Value="10" />
                                            <Setter Property="BorderThickness" Value="0" />
                                            <Setter Property="Background" Value="Transparent" />
                                            <!-- 优化项容器的布局更新频率 -->
                                            <Setter Property="UseLayoutRounding" Value="True" />
                                            <Setter Property="CacheMode" Value="BitmapCache" />
                                            <!-- 移除自定义ControlTemplate，使用默认模板，保持原有间距 -->
                                        </Style>
                                    </ListView.ItemContainerStyle>
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Padding="10">
                                                <TextBlock Text="{Binding Id}" Style="{StaticResource SubtitleTextBlockStyle}" />
                                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                    <TextBlock Text="{Binding Type}" Style="{StaticResource CaptionTextBlockStyle}" Foreground="Gray" />
                                                    <TextBlock Text=" | " Style="{StaticResource CaptionTextBlockStyle}" Foreground="Gray" />
                                                    <TextBlock Text="{Binding ReleaseTime}" Style="{StaticResource CaptionTextBlockStyle}" Foreground="Gray" />
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </Grid>
                        </Grid>
                    </TabViewItem>

                    <!-- Mod下载标签 -->
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_ModTabHeader" Text="Mod下载" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- Mod搜索和过滤 -->
                            <Grid Grid.Row="0" Margin="20,10,20,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Search Box -->
                                <AutoSuggestBox
                                    x:Name="ModSearchBox"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    PlaceholderText="Search mods..."
                                    QueryIcon="Find"
                                    Margin="0,0,10,0"
                                    Text="{Binding SearchQuery, Mode=TwoWay}"
                                    QuerySubmitted="ModSearchBox_QuerySubmitted"/>

                                <!-- Mod Loader Filter -->
                                <ComboBox
                                    x:Name="LoaderComboBox"
                                    x:Uid="ResourceDownloadPage_LoaderComboBox"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Header="加载器"
                                    PlaceholderText="加载器"
                                    Margin="0,0,10,0"
                                    MinWidth="120"
                                    SelectedValue="{Binding SelectedLoader, Mode=TwoWay}"
                                    SelectedValuePath="Tag"
                                    SelectionChanged="LoaderComboBox_SelectionChanged">
                                    <ComboBoxItem Content="All" Tag="all" IsSelected="True" />
                                    <ComboBoxItem Content="Fabric" Tag="fabric" />
                                    <ComboBoxItem Content="Forge" Tag="forge" />
                                    <ComboBoxItem Content="Quilt" Tag="quilt" />
                                    <ComboBoxItem Content="NeoForge" Tag="neoforge" />
                                </ComboBox>

                                <!-- Version Filter -->
                                <ComboBox
                                    x:Name="VersionComboBox"
                                    x:Uid="ResourceDownloadPage_VersionComboBox"
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    Header="版本"
                                    PlaceholderText="版本"
                                    Margin="0,0,10,0"
                                    MinWidth="120"
                                    ItemsSource="{Binding AvailableVersions, Mode=OneWay}"
                                    SelectedItem="{Binding SelectedVersion, Mode=TwoWay}"
                                    SelectionChanged="VersionComboBox_SelectionChanged">
                                </ComboBox>

                                <!-- 类别筛选 -->
                                <ComboBox
                                    x:Name="ModCategoryComboBox"
                                    x:Uid="ResourceDownloadPage_ModCategoryComboBox"
                                    Grid.Row="0"
                                    Grid.Column="3"
                                    Header="类别"
                                    PlaceholderText="所有类别"
                                    MinWidth="120"
                                    SelectedValuePath="Tag"
                                    SelectedValue="{Binding SelectedModCategory, Mode=TwoWay}"
                                    SelectionChanged="ModCategoryComboBox_SelectionChanged">
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_AllCategories" Content="所有类别" Tag="all" IsSelected="True" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_AdventureCategory" Content="冒险" Tag="adventure" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_CursedCategory" Content="整活" Tag="cursed" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_DecorationCategory" Content="装饰" Tag="decoration" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_EconomyCategory" Content="经济" Tag="economy" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_EquipmentCategory" Content="装备" Tag="equipment" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_FoodCategory" Content="食物" Tag="food" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_GameMechanicsCategory" Content="机制" Tag="game-mechanics" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_LibraryCategory" Content="前置" Tag="library" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_MagicCategory" Content="魔法" Tag="magic" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_ManagementCategory" Content="管理" Tag="management" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_MinigameCategory" Content="迷你游戏" Tag="minigame" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_MobsCategory" Content="生物" Tag="mobs" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_OptimizationCategory" Content="性能" Tag="optimization" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_SocialCategory" Content="社交" Tag="social" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_StorageCategory" Content="存储" Tag="storage" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_TechnologyCategory" Content="科技" Tag="technology" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_TransportationCategory" Content="交通" Tag="transportation" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_UtilityCategory" Content="实用" Tag="utility" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_WorldgenCategory" Content="世界生成" Tag="worldgen" />
                                </ComboBox>
                            </Grid>

                            <!-- Error Message -->
                            <Grid
                                Grid.Row="2"
                                Margin="20,10,20,10"
                                Background="#FFFDE7E9"
                                BorderBrush="#FFD53939"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Visibility="{Binding ErrorMessage, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToBoolConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.Column="0"
                                    Text="⚠"
                                    FontSize="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0"
                                    Foreground="#FFD53939"/>
                                <TextBlock
                                    Grid.Column="1"
                                    Text="{Binding ErrorMessage, Mode=OneWay}"
                                    Foreground="#FFD53939"
                                    Style="{ThemeResource BodyTextBlockStyle}"
                                    VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Loading Indicator -->
                            <ProgressRing
                                Grid.Row="2"
                                Margin="20"
                                IsActive="{Binding IsModLoading, Mode=OneWay}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding IsModLoading, Mode=OneWay}"/>

                            <!-- Mod列表 -->
                            <ScrollViewer 
                                x:Name="ModListScrollViewer"
                                Grid.Row="2"
                                Margin="20"
                                VerticalScrollBarVisibility="Auto"
                                ViewChanged="ModListScrollViewer_ScrollChanged">
                                    <!-- Mod列表 -->
                                    <ListView 
                                        x:Name="ModListView"
                                        SelectionMode="Single"
                                        ItemsSource="{Binding Mods, Mode=OneWay}"
                                        IsItemClickEnabled="True"
                                        ItemClick="ModListView_ItemClick"
                                        Visibility="{Binding IsModLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                        <ListView.Resources>
                                            <Style TargetType="ScrollViewer">
                                                <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                                            </Style>
                                        </ListView.Resources>
                                        <ListView.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <VirtualizingStackPanel VirtualizationMode="Recycling"/>
                                            </ItemsPanelTemplate>
                                        </ListView.ItemsPanel>
                                        <ListView.ItemContainerStyle>
                                            <Style TargetType="ListViewItem">
                                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                <Setter Property="Margin" Value="0,0,0,12"/>
                                            </Style>
                                        </ListView.ItemContainerStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="models:ModrinthProject">
                                                <Grid Height="120" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                      CornerRadius="8" Padding="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                      BorderThickness="1" Tapped="ModItem_Tapped">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- Mod Icon -->
                                                    <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3" Width="64" Height="64" Margin="0,0,12,0"
                                                            CornerRadius="32" Background="Transparent">
                                                        <Image Stretch="UniformToFill">
                                                            <Image.Source>
                                                                <BitmapImage UriSource="{Binding IconUrl, Mode=OneWay}" DecodePixelWidth="64" DecodePixelHeight="64"/>
                                                            </Image.Source>
                                                        </Image>
                                                    </Border>

                                                    <!-- Mod Name -->
                                                    <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Title, Mode=OneWay}"
                                                               FontSize="16" FontWeight="SemiBold"/>

                                                    <!-- Mod Description -->
                                                    <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Description, Mode=OneWay}"
                                                               Style="{ThemeResource BodyTextBlockStyle}" Opacity="0.8" TextWrapping="WrapWholeWords"
                                                               MaxLines="2" VerticalAlignment="Center"/>

                                                    <!-- Mod Info -->
                                                    <StackPanel Grid.Column="1" Grid.Row="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom">
                                                        <TextBlock Text="{Binding Author, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding LatestSupportedVersion, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding Downloads, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                        <!-- Loading More Indicator -->
                                        <ListView.Footer>
                                            <ProgressRing 
                                                IsActive="{Binding IsModLoadingMore, Mode=OneWay}" 
                                                Width="32" Height="32" 
                                                Margin="0,10,0,10" 
                                                HorizontalAlignment="Center"/>
                                        </ListView.Footer>
                                    </ListView>
                            </ScrollViewer>
                        </Grid>
                    </TabViewItem>

                    <!-- 光影下载标签 -->
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_ShaderPackTabHeader" Text="光影下载" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- 光影搜索和过滤 -->
                            <Grid Grid.Row="0" Margin="20,10,20,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Search Box -->
                                <AutoSuggestBox
                                    x:Name="ShaderPackSearchBox"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    PlaceholderText="Search shader packs..."
                                    QueryIcon="Find"
                                    Margin="0,0,10,0"
                                    Text="{Binding ShaderPackSearchQuery, Mode=TwoWay}"
                                    QuerySubmitted="ShaderPackSearchBox_QuerySubmitted"/>

                                <!-- Version Filter -->
                                <ComboBox
                                    x:Name="ShaderPackVersionComboBox"
                                    x:Uid="ResourceDownloadPage_ShaderPackVersionComboBox"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Header="版本"
                                    PlaceholderText="版本"
                                    Margin="0,0,10,0"
                                    MinWidth="120"
                                    ItemsSource="{Binding AvailableVersions, Mode=OneWay}"
                                    SelectedItem="{Binding SelectedShaderPackVersion, Mode=TwoWay}"
                                    SelectionChanged="ShaderPackVersionComboBox_SelectionChanged">
                                </ComboBox>

                                <!-- 类别筛选 -->
                                <ComboBox
                                    x:Name="ShaderPackCategoryComboBox"
                                    x:Uid="ResourceDownloadPage_ShaderPackCategoryComboBox"
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    Header="类别"
                                    PlaceholderText="所有类别"
                                    MinWidth="120"
                                    SelectedValuePath="Tag"
                                    SelectedValue="{Binding SelectedShaderPackCategory, Mode=TwoWay}"
                                    SelectionChanged="ShaderPackCategoryComboBox_SelectionChanged">
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_AllCategories" Content="所有类别" Tag="all" IsSelected="True" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_CartoonCategory" Content="卡通" Tag="cartoon" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_CursedCategory" Content="整活" Tag="cursed" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_FantasyCategory" Content="奇幻" Tag="fantasy" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_RealisticCategory" Content="写实" Tag="realistic" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_SemiRealisticCategory" Content="半写实" Tag="semi-realistic" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_VanillaLikeCategory" Content="原版风" Tag="vanilla-like" />
                                </ComboBox>
                            </Grid>

                            <!-- Error Message -->
                            <Grid
                                Grid.Row="2"
                                Margin="20,10,20,10"
                                Background="#FFFDE7E9"
                                BorderBrush="#FFD53939"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Visibility="{Binding ErrorMessage, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToBoolConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.Column="0"
                                    Text="⚠"
                                    FontSize="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0"
                                    Foreground="#FFD53939"/>
                                <TextBlock
                                    Grid.Column="1"
                                    Text="{Binding ErrorMessage, Mode=OneWay}"
                                    Foreground="#FFD53939"
                                    Style="{ThemeResource BodyTextBlockStyle}"
                                    VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Loading Indicator -->
                            <ProgressRing
                                Grid.Row="2"
                                Margin="20"
                                IsActive="{Binding IsShaderPackLoading, Mode=OneWay}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding IsShaderPackLoading, Mode=OneWay}"/>

                            <!-- 光影列表 -->
                            <ScrollViewer 
                                x:Name="ShaderPackListScrollViewer"
                                Grid.Row="2"
                                Margin="20"
                                VerticalScrollBarVisibility="Auto"
                                ViewChanged="ShaderPackListScrollViewer_ScrollChanged">
                                    <!-- 光影列表 -->
                                    <ListView 
                                        x:Name="ShaderPackListView"
                                        SelectionMode="Single"
                                        ItemsSource="{Binding ShaderPacks, Mode=OneWay}"
                                        IsItemClickEnabled="True"
                                        ItemClick="ShaderPackListView_ItemClick"
                                        Visibility="{Binding IsShaderPackLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                        <ListView.Resources>
                                            <Style TargetType="ScrollViewer">
                                                <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                                            </Style>
                                        </ListView.Resources>
                                        <ListView.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <VirtualizingStackPanel VirtualizationMode="Recycling"/>
                                            </ItemsPanelTemplate>
                                        </ListView.ItemsPanel>
                                        <ListView.ItemContainerStyle>
                                            <Style TargetType="ListViewItem">
                                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                <Setter Property="Margin" Value="0,0,0,12"/>
                                            </Style>
                                        </ListView.ItemContainerStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="models:ModrinthProject">
                                                <Grid Height="120" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                      CornerRadius="8" Padding="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                      BorderThickness="1" Tapped="ShaderPackItem_Tapped">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- 光影图标 -->
                                                    <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3" Width="64" Height="64" Margin="0,0,12,0"
                                                            CornerRadius="32" Background="Transparent">
                                                        <Image Stretch="UniformToFill">
                                                            <Image.Source>
                                                                <BitmapImage UriSource="{Binding IconUrl, Mode=OneWay}" DecodePixelWidth="64" DecodePixelHeight="64"/>
                                                            </Image.Source>
                                                        </Image>
                                                    </Border>

                                                    <!-- 光影名称 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Title, Mode=OneWay}"
                                                               FontSize="16" FontWeight="SemiBold"/>

                                                    <!-- 光影描述 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Description, Mode=OneWay}"
                                                               Style="{ThemeResource BodyTextBlockStyle}" Opacity="0.8" TextWrapping="WrapWholeWords"
                                                               MaxLines="2" VerticalAlignment="Center"/>

                                                    <!-- 光影信息 -->
                                                    <StackPanel Grid.Column="1" Grid.Row="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom">
                                                        <TextBlock Text="{Binding Author, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding LatestSupportedVersion, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding Downloads, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                        <!-- Loading More Indicator -->
                                        <ListView.Footer>
                                            <ProgressRing 
                                                IsActive="{Binding IsShaderPackLoadingMore, Mode=OneWay}" 
                                                Width="32" Height="32" 
                                                Margin="0,10,0,10" 
                                                HorizontalAlignment="Center"/>
                                        </ListView.Footer>
                                    </ListView>
                            </ScrollViewer>
                        </Grid>
                    </TabViewItem>

                    <!-- 资源包下载标签 -->
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="&#xE8B7;" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_ResourcePackTabHeader" Text="资源包下载" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- 资源包搜索和过滤 -->
                            <Grid Grid.Row="0" Margin="20,10,20,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Search Box -->
                                <AutoSuggestBox
                                    x:Name="ResourcePackSearchBox"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    PlaceholderText="Search resource packs..."
                                    QueryIcon="Find"
                                    Margin="0,0,10,0"
                                    Text="{Binding ResourcePackSearchQuery, Mode=TwoWay}"
                                    QuerySubmitted="ResourcePackSearchBox_QuerySubmitted"/>

                                <!-- Version Filter -->
                                <ComboBox
                                    x:Name="ResourcePackVersionComboBox"
                                    x:Uid="ResourceDownloadPage_ResourcePackVersionComboBox"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Header="版本"
                                    PlaceholderText="版本"
                                    Margin="0,0,10,0"
                                    MinWidth="120"
                                    ItemsSource="{Binding AvailableVersions, Mode=OneWay}"
                                    SelectedItem="{Binding SelectedResourcePackVersion, Mode=TwoWay}"
                                    SelectionChanged="ResourcePackVersionComboBox_SelectionChanged">
                                </ComboBox>

                                <!-- 类别筛选 -->
                                <ComboBox
                                    x:Name="ResourcePackCategoryComboBox"
                                    x:Uid="ResourceDownloadPage_ResourcePackCategoryComboBox"
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    Header="类别"
                                    PlaceholderText="所有类别"
                                    MinWidth="120"
                                    SelectedValuePath="Tag"
                                    SelectedValue="{Binding SelectedResourcePackCategory, Mode=TwoWay}"
                                    SelectionChanged="ResourcePackCategoryComboBox_SelectionChanged">
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_AllCategories" Content="所有类别" Tag="all" IsSelected="True" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_CombatCategory" Content="战斗" Tag="combat" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_CursedCategory" Content="整活" Tag="cursed" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_DecorationCategory" Content="装饰" Tag="decoration" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_ModdedCategory" Content="适配模组" Tag="modded" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_RealisticCategory" Content="写实" Tag="realistic" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_SimplisticCategory" Content="简约" Tag="simplistic" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_ThemedCategory" Content="主题化" Tag="themed" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_TweaksCategory" Content="微调" Tag="tweaks" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_UtilityCategory" Content="实用" Tag="utility" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_VanillaLikeCategory" Content="原版风" Tag="vanilla-like" />
                                </ComboBox>
                            </Grid>

                            <!-- Error Message -->
                            <Grid
                                Grid.Row="2"
                                Margin="20,10,20,10"
                                Background="#FFFDE7E9"
                                BorderBrush="#FFD53939"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Visibility="{Binding ErrorMessage, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToBoolConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.Column="0"
                                    Text="⚠"
                                    FontSize="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0"
                                    Foreground="#FFD53939"/>
                                <TextBlock
                                    Grid.Column="1"
                                    Text="{Binding ErrorMessage, Mode=OneWay}"
                                    Foreground="#FFD53939"
                                    Style="{ThemeResource BodyTextBlockStyle}"
                                    VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Loading Indicator -->
                            <ProgressRing
                                Grid.Row="2"
                                Margin="20"
                                IsActive="{Binding IsResourcePackLoading, Mode=OneWay}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding IsResourcePackLoading, Mode=OneWay}"/>

                            <!-- 资源包列表 -->
                            <ScrollViewer 
                                x:Name="ResourcePackListScrollViewer"
                                Grid.Row="2"
                                Margin="20"
                                VerticalScrollBarVisibility="Auto"
                                ViewChanged="ResourcePackListScrollViewer_ScrollChanged">
                                    <!-- 资源包列表 -->
                                    <ListView 
                                        x:Name="ResourcePackListView"
                                        SelectionMode="Single"
                                        ItemsSource="{Binding ResourcePacks, Mode=OneWay}"
                                        IsItemClickEnabled="True"
                                        ItemClick="ResourcePackListView_ItemClick"
                                        Visibility="{Binding IsResourcePackLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                        <ListView.Resources>
                                            <Style TargetType="ScrollViewer">
                                                <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                                            </Style>
                                        </ListView.Resources>
                                        <ListView.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <VirtualizingStackPanel VirtualizationMode="Recycling"/>
                                            </ItemsPanelTemplate>
                                        </ListView.ItemsPanel>
                                        <ListView.ItemContainerStyle>
                                            <Style TargetType="ListViewItem">
                                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                <Setter Property="Margin" Value="0,0,0,12"/>
                                            </Style>
                                        </ListView.ItemContainerStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="models:ModrinthProject">
                                                <Grid Height="120" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                      CornerRadius="8" Padding="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                      BorderThickness="1" Tapped="ResourcePackItem_Tapped">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- 资源包图标 -->
                                                    <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3" Width="64" Height="64" Margin="0,0,12,0"
                                                            CornerRadius="32" Background="Transparent">
                                                        <Image Stretch="UniformToFill">
                                                            <Image.Source>
                                                                <BitmapImage UriSource="{Binding IconUrl, Mode=OneWay}" DecodePixelWidth="64" DecodePixelHeight="64"/>
                                                            </Image.Source>
                                                        </Image>
                                                    </Border>

                                                    <!-- 资源包名称 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Title, Mode=OneWay}"
                                                               FontSize="16" FontWeight="SemiBold"/>

                                                    <!-- 资源包描述 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Description, Mode=OneWay}"
                                                               Style="{ThemeResource BodyTextBlockStyle}" Opacity="0.8" TextWrapping="WrapWholeWords"
                                                               MaxLines="2" VerticalAlignment="Center"/>

                                                    <!-- 资源包信息 -->
                                                    <StackPanel Grid.Column="1" Grid.Row="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom">
                                                        <TextBlock Text="{Binding Author, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding LatestSupportedVersion, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding Downloads, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                        <!-- Loading More Indicator -->
                                        <ListView.Footer>
                                            <ProgressRing 
                                                IsActive="{Binding IsResourcePackLoadingMore, Mode=OneWay}" 
                                                Width="32" Height="32" 
                                                Margin="0,10,0,10" 
                                                HorizontalAlignment="Center"/>
                                        </ListView.Footer>
                                    </ListView>
                            </ScrollViewer>
                        </Grid>
                    </TabViewItem>
                    
                    <!-- 数据包下载标签 -->
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="&#xE760;" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_DatapackTabHeader" Text="数据包下载" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- 数据包搜索和过滤 -->
                            <Grid Grid.Row="0" Margin="20,10,20,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Search Box -->
                                <AutoSuggestBox
                                    x:Name="DatapackSearchBox"
                                    x:Uid="ResourceDownloadPage_DatapackSearchBox"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    PlaceholderText="Search datapacks..."
                                    QueryIcon="Find"
                                    Margin="0,0,10,0"
                                    Text="{Binding DatapackSearchQuery, Mode=TwoWay}"
                                    QuerySubmitted="DatapackSearchBox_QuerySubmitted"/>

                                <!-- Version Filter -->
                                <ComboBox
                                    x:Name="DatapackVersionComboBox"
                                    x:Uid="ResourceDownloadPage_DatapackVersionComboBox"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Header="版本"
                                    PlaceholderText="版本"
                                    Margin="0,0,10,0"
                                    MinWidth="120"
                                    ItemsSource="{Binding AvailableVersions, Mode=OneWay}"
                                    SelectedItem="{Binding SelectedDatapackVersion, Mode=TwoWay}"
                                    SelectionChanged="DatapackVersionComboBox_SelectionChanged">
                                </ComboBox>

                                <!-- 类别筛选 -->
                                <ComboBox
                                    x:Name="DatapackCategoryComboBox"
                                    x:Uid="ResourceDownloadPage_DatapackCategoryComboBox"
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    Header="类别"
                                    PlaceholderText="所有类别"
                                    MinWidth="120"
                                    SelectedValuePath="Tag"
                                    SelectedValue="{Binding SelectedDatapackCategory, Mode=TwoWay}"
                                    SelectionChanged="DatapackCategoryComboBox_SelectionChanged">
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_AllCategories" Content="所有类别" Tag="all" IsSelected="True" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_AdventureCategory" Content="冒险" Tag="adventure" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_CursedCategory" Content="整活" Tag="cursed" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_DecorationCategory" Content="装饰" Tag="decoration" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_EconomyCategory" Content="经济" Tag="economy" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_EquipmentCategory" Content="装备" Tag="equipment" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_FoodCategory" Content="食物" Tag="food" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_GameMechanicsCategory" Content="游戏机制" Tag="game-mechanics" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_LibraryCategory" Content="前置" Tag="library" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_MagicCategory" Content="魔法" Tag="magic" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_ManagementCategory" Content="管理" Tag="management" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_MinigameCategory" Content="迷你游戏" Tag="minigame" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_MobsCategory" Content="生物" Tag="mobs" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_OptimizationCategory" Content="性能" Tag="optimization" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_SocialCategory" Content="社交" Tag="social" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_StorageCategory" Content="存储" Tag="storage" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_TechnologyCategory" Content="科技" Tag="technology" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_TransportationCategory" Content="交通" Tag="transportation" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_UtilityCategory" Content="实用" Tag="utility" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_WorldgenCategory" Content="世界生成" Tag="worldgen" />
                                </ComboBox>
                            </Grid>

                            <!-- Error Message -->
                            <Grid
                                Grid.Row="2"
                                Margin="20,10,20,10"
                                Background="#FFFDE7E9"
                                BorderBrush="#FFD53939"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Visibility="{Binding ErrorMessage, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToBoolConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.Column="0"
                                    Text="⚠"
                                    FontSize="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0"
                                    Foreground="#FFD53939"/>
                                <TextBlock
                                    Grid.Column="1"
                                    Text="{Binding ErrorMessage, Mode=OneWay}"
                                    Foreground="#FFD53939"
                                    Style="{ThemeResource BodyTextBlockStyle}"
                                    VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Loading Indicator -->
                            <ProgressRing
                                Grid.Row="2"
                                Margin="20"
                                IsActive="{Binding IsDatapackLoading, Mode=OneWay}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding IsDatapackLoading, Mode=OneWay}"/>

                            <!-- 数据包列表 -->
                            <ScrollViewer 
                                x:Name="DatapackListScrollViewer"
                                Grid.Row="2"
                                Margin="20"
                                VerticalScrollBarVisibility="Auto"
                                ViewChanged="DatapackListScrollViewer_ScrollChanged">
                                    <!-- 数据包列表 -->
                                    <ListView 
                                        x:Name="DatapackListView"
                                        SelectionMode="Single"
                                        ItemsSource="{Binding Datapacks, Mode=OneWay}"
                                        IsItemClickEnabled="True"
                                        ItemClick="DatapackListView_ItemClick"
                                        Visibility="{Binding IsDatapackLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                        <ListView.Resources>
                                            <Style TargetType="ScrollViewer">
                                                <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                                            </Style>
                                        </ListView.Resources>
                                        <ListView.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <VirtualizingStackPanel VirtualizationMode="Recycling"/>
                                            </ItemsPanelTemplate>
                                        </ListView.ItemsPanel>
                                        <ListView.ItemContainerStyle>
                                            <Style TargetType="ListViewItem">
                                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                <Setter Property="Margin" Value="0,0,0,12"/>
                                            </Style>
                                        </ListView.ItemContainerStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="models:ModrinthProject">
                                                <Grid Height="120" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                      CornerRadius="8" Padding="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                      BorderThickness="1" Tapped="DatapackItem_Tapped">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- 数据包图标 -->
                                                    <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3" Width="64" Height="64" Margin="0,0,12,0"
                                                            CornerRadius="32" Background="Transparent">
                                                        <Image Stretch="UniformToFill">
                                                            <Image.Source>
                                                                <BitmapImage UriSource="{Binding IconUrl, Mode=OneWay}" DecodePixelWidth="64" DecodePixelHeight="64"/>
                                                            </Image.Source>
                                                        </Image>
                                                    </Border>

                                                    <!-- 数据包名称 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Title, Mode=OneWay}"
                                                               FontSize="16" FontWeight="SemiBold"/>

                                                    <!-- 数据包描述 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Description, Mode=OneWay}"
                                                               Style="{ThemeResource BodyTextBlockStyle}" Opacity="0.8" TextWrapping="WrapWholeWords"
                                                               MaxLines="2" VerticalAlignment="Center"/>

                                                    <!-- 数据包信息 -->
                                                    <StackPanel Grid.Column="1" Grid.Row="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom">
                                                        <TextBlock Text="{Binding Author, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding LatestSupportedVersion, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding Downloads, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                        <!-- Loading More Indicator -->
                                        <ListView.Footer>
                                            <ProgressRing 
                                                IsActive="{Binding IsDatapackLoadingMore, Mode=OneWay}" 
                                                Width="32" Height="32" 
                                                Margin="0,10,0,10" 
                                                HorizontalAlignment="Center"/>
                                        </ListView.Footer>
                                    </ListView>
                            </ScrollViewer>
                        </Grid>
                    </TabViewItem>
                    
                    <!-- 整合包下载标签 -->
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_ModpackTabHeader" Text="整合包下载" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- 整合包搜索和过滤 -->
                            <Grid Grid.Row="0" Margin="20,10,20,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Search Box -->
                                <AutoSuggestBox
                                    x:Name="ModpackSearchBox"
                                    x:Uid="ResourceDownloadPage_ModpackSearchBox"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    PlaceholderText="Search modpacks..."
                                    QueryIcon="Find"
                                    Margin="0,0,10,0"
                                    Text="{Binding ModpackSearchQuery, Mode=TwoWay}"
                                    QuerySubmitted="ModpackSearchBox_QuerySubmitted"/>

                                <!-- Version Filter -->
                                <ComboBox
                                    x:Name="ModpackVersionComboBox"
                                    x:Uid="ResourceDownloadPage_ModpackVersionComboBox"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Header="版本"
                                    PlaceholderText="版本"
                                    Margin="0,0,10,0"
                                    MinWidth="120"
                                    ItemsSource="{Binding AvailableVersions, Mode=OneWay}"
                                    SelectedItem="{Binding SelectedModpackVersion, Mode=TwoWay}"
                                    SelectionChanged="ModpackVersionComboBox_SelectionChanged">
                                </ComboBox>

                                <!-- 类别筛选 -->
                                <ComboBox
                                    x:Name="ModpackCategoryComboBox"
                                    x:Uid="ResourceDownloadPage_ModpackCategoryComboBox"
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    Header="类别"
                                    PlaceholderText="所有类别"
                                    MinWidth="120"
                                    SelectedValuePath="Tag"
                                    SelectedValue="{Binding SelectedModpackCategory, Mode=TwoWay}"
                                    SelectionChanged="ModpackCategoryComboBox_SelectionChanged">
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_AllCategories" Content="所有类别" Tag="all" IsSelected="True" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_AdventureCategory" Content="冒险" Tag="adventure" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_ChallengingCategory" Content="硬核" Tag="challenging" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_CombatCategory" Content="战斗" Tag="combat" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_KitchenSinkCategory" Content="全能型" Tag="kitchen-sink" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_LightweightCategory" Content="轻量" Tag="lightweight" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_MagicCategory" Content="魔法" Tag="magic" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_MultiplayerCategory" Content="联机" Tag="multiplayer" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_OptimizationCategory" Content="性能" Tag="optimization" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_QuestsCategory" Content="任务" Tag="quests" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_TechnologyCategory" Content="科技" Tag="technology" />
                                </ComboBox>
                            </Grid>

                            <!-- Error Message -->
                            <Grid
                                Grid.Row="2"
                                Margin="20,10,20,10"
                                Background="#FFFDE7E9"
                                BorderBrush="#FFD53939"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Visibility="{Binding ErrorMessage, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToBoolConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.Column="0"
                                    Text="⚠"
                                    FontSize="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0"
                                    Foreground="#FFD53939"/>
                                <TextBlock
                                    Grid.Column="1"
                                    Text="{Binding ErrorMessage, Mode=OneWay}"
                                    Foreground="#FFD53939"
                                    Style="{ThemeResource BodyTextBlockStyle}"
                                    VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Loading Indicator -->
                            <ProgressRing
                                Grid.Row="2"
                                Margin="20"
                                IsActive="{Binding IsModpackLoading, Mode=OneWay}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding IsModpackLoading, Mode=OneWay}"/>

                            <!-- 整合包列表 -->
                            <ScrollViewer 
                                x:Name="ModpackListScrollViewer"
                                Grid.Row="2"
                                Margin="20"
                                VerticalScrollBarVisibility="Auto"
                                ViewChanged="ModpackListScrollViewer_ScrollChanged">
                                    <!-- 整合包列表 -->
                                    <ListView 
                                        x:Name="ModpackListView"
                                        SelectionMode="Single"
                                        ItemsSource="{Binding Modpacks, Mode=OneWay}"
                                        IsItemClickEnabled="True"
                                        ItemClick="ModpackListView_ItemClick"
                                        Visibility="{Binding IsModpackLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                        <ListView.Resources>
                                            <Style TargetType="ScrollViewer">
                                                <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                                            </Style>
                                        </ListView.Resources>
                                        <ListView.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <VirtualizingStackPanel VirtualizationMode="Recycling"/>
                                            </ItemsPanelTemplate>
                                        </ListView.ItemsPanel>
                                        <ListView.ItemContainerStyle>
                                            <Style TargetType="ListViewItem">
                                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                <Setter Property="Margin" Value="0,0,0,12"/>
                                            </Style>
                                        </ListView.ItemContainerStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="models:ModrinthProject">
                                                <Grid Height="120" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                      CornerRadius="8" Padding="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                      BorderThickness="1" Tapped="ModpackItem_Tapped">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- 整合包图标 -->
                                                    <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3" Width="64" Height="64" Margin="0,0,12,0"
                                                            CornerRadius="32" Background="Transparent">
                                                        <Image Stretch="UniformToFill">
                                                            <Image.Source>
                                                                <BitmapImage UriSource="{Binding IconUrl, Mode=OneWay}" DecodePixelWidth="64" DecodePixelHeight="64"/>
                                                            </Image.Source>
                                                        </Image>
                                                    </Border>

                                                    <!-- 整合包名称 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Title, Mode=OneWay}"
                                                               FontSize="16" FontWeight="SemiBold"/>

                                                    <!-- 整合包描述 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Description, Mode=OneWay}"
                                                               Style="{ThemeResource BodyTextBlockStyle}" Opacity="0.8" TextWrapping="WrapWholeWords"
                                                               MaxLines="2" VerticalAlignment="Center"/>

                                                    <!-- 整合包信息 -->
                                                    <StackPanel Grid.Column="1" Grid.Row="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom">
                                                        <TextBlock Text="{Binding Author, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding LatestSupportedVersion, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding Downloads, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                        <!-- Loading More Indicator -->
                                        <ListView.Footer>
                                            <ProgressRing 
                                                IsActive="{Binding IsModpackLoadingMore, Mode=OneWay}" 
                                                Width="32" Height="32" 
                                                Margin="0,10,0,10" 
                                                HorizontalAlignment="Center"/>
                                        </ListView.Footer>
                                    </ListView>
                            </ScrollViewer>
                        </Grid>
                    </TabViewItem>
                </TabView.TabItems>
            </TabView>
        </Grid>
    </Grid>
</Page>