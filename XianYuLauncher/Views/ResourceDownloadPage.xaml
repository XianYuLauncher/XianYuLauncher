<Page
    x:Class="XianYuLauncher.Views.ResourceDownloadPage"
    x:Name="ThisPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="using:XianYuLauncher.Helpers"
    xmlns:viewModels="using:XianYuLauncher.ViewModels"
    xmlns:models="using:XianYuLauncher.Core.Models"
    xmlns:animations="using:CommunityToolkit.WinUI.Animations"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:media="using:CommunityToolkit.WinUI.Media"
    NavigationCacheMode="Required"
    mc:Ignorable="d">

    <Page.Resources>
        <Style x:Key="CommunityResourceListViewItemStyle" TargetType="ListViewItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="Margin" Value="0,0,0,12" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <ListViewItemPresenter
                            Content="{TemplateBinding Content}"
                            ContentTemplate="{TemplateBinding ContentTemplate}"
                            ContentTemplateSelector="{TemplateBinding ContentTemplateSelector}"
                            ContentTransitions="{TemplateBinding ContentTransitions}"
                            HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                            VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                            Padding="{TemplateBinding Padding}"
                            Background="Transparent"
                            PointerOverBackground="Transparent"
                            PressedBackground="Transparent"
                            SelectedBackground="Transparent"
                            SelectedPointerOverBackground="Transparent"
                            SelectedPressedBackground="Transparent"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}" />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="CardGridViewItemStyle" TargetType="GridViewItem">
            <Setter Property="Margin" Value="6" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="VerticalContentAlignment" Value="Stretch" />
        </Style>
        <helpers:BoolToOpacityConverter x:Key="BoolToOpacityConverter" />
    </Page.Resources>

    <Grid x:Name="ContentArea" Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 收藏夹导入 - 游戏版本选择弹窗 -->
        <ContentDialog
            x:Name="FavoritesVersionDialog"
            Title="选择游戏版本"
            PrimaryButtonText="确认"
            CloseButtonText="取消"
            DefaultButton="Primary"
            PrimaryButtonClick="FavoritesVersionDialog_PrimaryButtonClick"
            CloseButtonClick="FavoritesVersionDialog_CloseButtonClick">
            <StackPanel Spacing="12">
                <TextBlock Text="请选择要导入的游戏版本：" FontSize="14" />
                <ListView
                    ItemsSource="{x:Bind ViewModel.FavoritesInstallVersions, Mode=OneWay}"
                    SelectedItem="{x:Bind ViewModel.SelectedFavoritesInstallVersion, Mode=TwoWay}"
                    SelectionMode="Single"
                    MaxHeight="300">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="viewModels:InstalledGameVersionViewModel">
                            <Grid Padding="8">
                                <TextBlock Text="{x:Bind DisplayName}" />
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackPanel>
        </ContentDialog>

        <!-- 收藏夹导入 - 下载进度弹窗 -->
        <ContentDialog
            x:Name="FavoritesDownloadProgressDialog"
            Title="收藏夹下载中"
            CloseButtonText="后台下载"
            DefaultButton="None"
            CloseButtonClick="FavoritesDownloadProgressDialog_CloseButtonClick">
            <StackPanel Spacing="16" Width="400">
                <TextBlock Text="{x:Bind ViewModel.FavoritesDownloadStatus, Mode=OneWay}"
                           FontSize="16" TextWrapping="WrapWholeWords" />
                <ProgressBar Value="{x:Bind ViewModel.FavoritesDownloadProgress, Mode=OneWay}"
                             Minimum="0" Maximum="100" Height="8" CornerRadius="4" />
                <TextBlock Text="{x:Bind ViewModel.FavoritesDownloadProgressText, Mode=OneWay}"
                           FontSize="14" Foreground="{ThemeResource TextFillColorSecondary}" HorizontalTextAlignment="Center" />
            </StackPanel>
        </ContentDialog>

        <!-- 收藏夹导入结果弹窗（仅不支持版本时显示） -->
        <ContentDialog
            x:Name="FavoritesImportResultDialog"
            Title="部分资源不支持此版本"
            PrimaryButtonText="确定"
            DefaultButton="Primary"
            PrimaryButtonClick="FavoritesImportResultDialog_PrimaryButtonClick">
            <StackPanel Spacing="12">
                <TextBlock Text="以下资源不支持所选版本：" FontSize="14" />
                <ListView
                    ItemsSource="{x:Bind ViewModel.FavoriteImportResults, Mode=OneWay}"
                    MaxHeight="400">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="viewModels:FavoriteImportResult">
                            <Grid Padding="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.Column="0"
                                    Text="{x:Bind ItemName}"
                                    Opacity="{x:Bind IsGrayedOut, Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='1.0,0.5'}" />
                                <TextBlock
                                    Grid.Column="1"
                                    Text="{x:Bind StatusText}"
                                    Opacity="{x:Bind IsGrayedOut, Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='1.0,0.5'}"
                                    Style="{ThemeResource CaptionTextBlockStyle}" />
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackPanel>
        </ContentDialog>

        <!-- 分享码导入弹窗 -->
        <ContentDialog
            x:Name="ShareCodeImportDialog"
            Title="导入分享码"
            PrimaryButtonText="导入"
            CloseButtonText="取消"
            DefaultButton="Primary"
            PrimaryButtonClick="ShareCodeImportDialog_PrimaryButtonClick"
            CloseButtonClick="ShareCodeImportDialog_CloseButtonClick">
            <StackPanel Spacing="12" Width="400">
                <TextBlock Text="请粘贴分享码（支持JSON数组或换行分隔）：" FontSize="14" />
                <TextBox
                    Text="{x:Bind ViewModel.ShareCodeInput, Mode=TwoWay}"
                    AcceptsReturn="True"
                    TextWrapping="Wrap"
                    Height="140" />
            </StackPanel>
        </ContentDialog>

        <!-- 顶部标题和收藏夹区域 -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- 标题区域 -->
            <StackPanel Grid.Column="0">
                <TextBlock x:Name="PageTitle" x:Uid="ResourceDownloadPage_PageTitle" Text="资源下载" Style="{ThemeResource TitleTextBlockStyle}" />
                <TextBlock x:Name="PageSubtitle" x:Uid="ResourceDownloadPage_PageSubtitle" Text="下载和管理Minecraft资源" Style="{StaticResource BodyTextStyle}" Margin="0,8,0,0" Opacity="0.7" />
            </StackPanel>

            <!-- 收藏夹拖放区域 -->
            <Grid Grid.Column="1" VerticalAlignment="Bottom" Margin="0,0,20,0">
                <Button x:Name="FavoritesDropArea"
                        x:Uid="ResourceDownloadPage_FavoritesButton"
                        AllowDrop="True"
                        DragOver="FavoritesDropArea_DragOver"
                        DragLeave="FavoritesDropArea_DragLeave"
                        Drop="FavoritesDropArea_Drop"
                        Background="Transparent"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12,6"
                        ToolTipService.ToolTip="拖拽资源到此处以收藏">

                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE734;" FontSize="16" />
                        <TextBlock x:Uid="ResourceDownloadPage_FavoritesText" Text="收藏夹" />
                    </StackPanel>

                    <Button.Flyout>
                        <Flyout Placement="BottomEdgeAlignedRight">
                            <Grid Width="320" Height="400">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock x:Uid="ResourceDownloadPage_FavoritesFlyoutTitle" Text="收藏的资源" Style="{StaticResource SubtitleTextBlockStyle}" Margin="12,12,12,6"/>

                                <ListView Grid.Row="1" 
                                          ItemsSource="{x:Bind ViewModel.FavoriteItems, Mode=OneWay}" 
                                          SelectionMode="{x:Bind GetSelectionMode(ViewModel.IsFavoritesSelectionMode), Mode=OneWay}"
                                          SelectionChanged="FavoritesListView_SelectionChanged"
                                          IsItemClickEnabled="True"
                                          ItemClick="FavoritesListView_ItemClick">
                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="models:ModrinthProject">
                                            <Grid Margin="0,8" AutomationProperties.Name="{x:Bind DisplayTitle}">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="32"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Border CornerRadius="4" Width="32" Height="32" Background="{ThemeResource LayerFillColorDefaultBrush}">
                                                    <Image Stretch="UniformToFill">
                                                        <Image.Source>
                                                            <BitmapImage UriSource="{x:Bind IconUrl}" />
                                                        </Image.Source>
                                                    </Image>
                                                </Border>
                                                <StackPanel Grid.Column="1" Margin="12,0,8,0" VerticalAlignment="Center">
                                                    <TextBlock Text="{x:Bind DisplayTitle}" MaxLines="1" TextTrimming="CharacterEllipsis" FontWeight="SemiBold"/>
                                                    <TextBlock Text="{x:Bind Author}" MaxLines="1" TextTrimming="CharacterEllipsis" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                </StackPanel>
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>

                                <!-- Empty State -->
                                <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center" 
                                            Visibility="{x:Bind ViewModel.IsFavoritesEmpty, Mode=OneWay}" Spacing="8">
                                    <FontIcon Glyph="&#xE734;" FontSize="24" Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                    <TextBlock x:Uid="ResourceDownloadPage_FavoritesEmpty" Text="暂无收藏" Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                    <TextBlock x:Uid="ResourceDownloadPage_FavoritesDragHint" Text="拖拽列表项到收藏夹按钮" FontSize="12" Foreground="{ThemeResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center"/>
                                </StackPanel>
                                
                                <!-- Function Bar -->
                                <Grid Grid.Row="2" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,1,0,0" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="12,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Left: Actions -->
                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                        <Button x:Uid="ResourceDownloadPage_ImportFavoritesButton" ToolTipService.ToolTip="导入收藏到版本"
                                                IsEnabled="{x:Bind ViewModel.IsImportFavoritesEnabled, Mode=OneWay}"
                                                Command="{x:Bind ViewModel.OpenFavoritesImportCommand}" 
                                                Padding="8,4" Background="Transparent" BorderThickness="0">
                                            <FontIcon Glyph="&#xE896;" FontSize="14" />
                                        </Button>
                                    </StackPanel>
                                    
                                    <!-- Right: Tools -->
                                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4">
                                        <Button x:Uid="ResourceDownloadPage_RemoveFavoritesButton" ToolTipService.ToolTip="删除选中项" Command="{x:Bind ViewModel.RemoveSelectedFavoritesCommand}" Padding="8,4" Background="Transparent" BorderThickness="0">
                                            <FontIcon Glyph="&#xE74D;" FontSize="14" />
                                        </Button>
                                        <Button ToolTipService.ToolTip="导入分享码" Command="{x:Bind ViewModel.OpenShareCodeImportCommand}" Padding="8,4" Background="Transparent" BorderThickness="0">
                                            <FontIcon Glyph="&#xE7A7;" FontSize="14" />
                                        </Button>
                                        <Button ToolTipService.ToolTip="复制分享码" Command="{x:Bind ViewModel.CopyShareCodeCommand}" Padding="8,4" Background="Transparent" BorderThickness="0">
                                            <FontIcon Glyph="&#xE8C8;" FontSize="14" />
                                        </Button>
                                        <ToggleButton ToolTipService.ToolTip="多选模式" IsChecked="{x:Bind ViewModel.IsFavoritesSelectionMode, Mode=OneWay}" Command="{x:Bind ViewModel.ToggleFavoritesSelectionModeCommand}" Padding="8,4" Background="Transparent" BorderThickness="0">
                                            <FontIcon Glyph="&#xE762;" FontSize="14" />
                                        </ToggleButton>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Flyout>
                    </Button.Flyout>
                </Button>
            </Grid>
        </Grid>

        <!-- 主要内容区域 -->
        <Grid Grid.Row="1">
            <!-- TabView控件 -->
            <TabView 
                x:Name="ResourceTabView" 
                HorizontalAlignment="Stretch" 
                VerticalAlignment="Stretch" 
                Height="Auto" 
                SelectedIndex="0"
                SelectionChanged="ResourceTabView_SelectionChanged"
                IsAddTabButtonVisible="False"
                CanDragTabs="False"
                CanReorderTabs="False">
                <TabView.Resources>
                    <Style TargetType="TabViewItem">
                        <Setter Property="IsClosable" Value="False" />
                    </Style>
                </TabView.Resources>
                
                <!-- 版本下载标签 -->
                <TabView.TabItems>
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_VersionTabHeader" Text="版本下载" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <animations:Implicit.ShowAnimations>
                                <animations:TranslationAnimation Duration="0:0:0.5" From="0, 40, 0" To="0" EasingMode="EaseOut" />
                                <animations:OpacityAnimation Duration="0:0:0.5" From="0" To="1.0" />
                            </animations:Implicit.ShowAnimations>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!-- 最新版本卡片 -->
                            <Grid Grid.Row="0" Margin="12,10,12,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="10" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!-- 最新正式版 -->
                                <Border CornerRadius="8" Padding="15" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" Background="{ThemeResource CardBackgroundFillColorDefault}" HorizontalAlignment="Stretch">
                                    <StackPanel>
                                        <TextBlock x:Uid="ResourceDownloadPage_LatestRelease" Text="最新正式版" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondary}" />
                                        <TextBlock Text="{Binding LatestReleaseVersion, Mode=OneWay}" Style="{StaticResource TitleTextBlockStyle}" Foreground="{ThemeResource TextFillColorPrimary}" />
                                        <Button x:Uid="ResourceDownloadPage_DownloadButton" Content="下载" Style="{StaticResource DefaultButtonStyle}" HorizontalAlignment="Left" Margin="0,10,0,0"
                                                Command="{Binding DownloadVersionCommand}" CommandParameter="{Binding LatestReleaseVersion, Mode=OneWay}" />
                                    </StackPanel>
                                </Border>

                                <!-- 最新快照版 -->
                                <Border Grid.Column="2" CornerRadius="8" Padding="15" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" Background="{ThemeResource CardBackgroundFillColorDefault}" HorizontalAlignment="Stretch">
                                    <StackPanel>
                                        <TextBlock x:Uid="ResourceDownloadPage_LatestSnapshot" Text="最新快照版" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondary}" />
                                        <TextBlock Text="{Binding LatestSnapshotVersion, Mode=OneWay}" Style="{StaticResource TitleTextBlockStyle}" Foreground="{ThemeResource TextFillColorPrimary}" />
                                        <Button x:Uid="ResourceDownloadPage_DownloadButton" Content="下载" Style="{StaticResource DefaultButtonStyle}" HorizontalAlignment="Left" Margin="0,10,0,0"
                                                Command="{Binding DownloadVersionCommand}" CommandParameter="{Binding LatestSnapshotVersion, Mode=OneWay}" />
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- 搜索和刷新 -->
                            <Grid Grid.Row="1" Margin="12,0,12,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <TextBox 
                                    Grid.Column="0"
                                    x:Name="VersionSearchBox"
                                    x:Uid="ResourceDownloadPage_VersionSearchBox"
                                    PlaceholderText="搜索版本..."
                                    Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                    KeyDown="VersionSearchBox_KeyDown" 
                                    HorizontalAlignment="Stretch" />

                                <!-- 版本类型筛选 -->
                                <ComboBox
                                    Grid.Column="1"
                                    x:Name="VersionTypeComboBox"
                                    x:Uid="ResourceDownloadPage_VersionTypeComboBox"
                                    Margin="10,0,0,0"
                                    MinWidth="80"
                                    PlaceholderText="筛选"
                                    SelectedValuePath="Tag"
                                    SelectedValue="{Binding SelectedVersionType, Mode=TwoWay}">
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_AllVersionTypes" Content="全部" Tag="all" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_ReleaseVersionType" Content="正式版" Tag="release" IsSelected="True" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_SnapshotVersionType" Content="快照版" Tag="snapshot" />
                                    <ComboBoxItem x:Uid="ResourceDownloadPage_OldVersionType" Content="旧版" Tag="old" />
                                </ComboBox>

                                <Button 
                                    Grid.Column="2"
                                    Margin="10,0,0,0"
                                    Command="{Binding RefreshVersionsCommand}">
                                    <Grid>
                                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xe72c;" Visibility="{Binding IsRefreshing, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}" />
                                        <ProgressRing IsActive="{Binding IsRefreshing, Mode=OneWay}" Width="20" Height="20" Visibility="{Binding IsRefreshing, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                                    </Grid>
                                </Button>
                            </Grid>

                            <!-- 版本列表 -->
                            <Grid Grid.Row="2" Margin="12,0,12,0">
                                <!-- 加载指示器 -->
                                <ProgressRing IsActive="{Binding IsVersionLoading, Mode=OneWay}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                  
                                <!-- 版本列表 -->
                                <ListView 
                                    x:Name="VersionListView"
                                    ItemsSource="{Binding FilteredVersions, Mode=OneWay}"
                                    IsItemClickEnabled="True"
                                    ItemClick="VersionListView_ItemClick"
                                    SelectionMode="None"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Visibility="{Binding IsVersionLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}"
                                    ShowsScrollingPlaceholders="True">
                                    <ListView.Resources>
                                        <Style TargetType="ScrollViewer">
                                            <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                                            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
                                            <Setter Property="IsScrollInertiaEnabled" Value="True"/>
                                            <Setter Property="ScrollViewer.VerticalScrollMode" Value="Enabled"/>
                                            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
                                        </Style>
                                    </ListView.Resources>
                                    <ListView.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <!-- 使用ItemsStackPanel替代VirtualizingStackPanel，提供更好的平滑滚动支持 -->
                                            <!-- ItemsStackPanel默认启用虚拟化，不需要设置VirtualizationMode属性 -->
                                            <ItemsStackPanel/>
                                        </ItemsPanelTemplate>
                                    </ListView.ItemsPanel>
                                    <ListView.ItemContainerStyle>
                                        <Style TargetType="ListViewItem">
                                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                            <Setter Property="Margin" Value="0,0,0,10" />
                                            <Setter Property="Padding" Value="10" />
                                            <Setter Property="BorderThickness" Value="0" />
                                            <Setter Property="Background" Value="Transparent" />
                                            <!-- 优化项容器的布局更新频率 -->
                                            <Setter Property="UseLayoutRounding" Value="True" />
                                            <Setter Property="CacheMode" Value="BitmapCache" />
                                            <!-- 移除自定义ControlTemplate，使用默认模板，保持原有间距 -->
                                        </Style>
                                    </ListView.ItemContainerStyle>
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Padding="10">
                                                <StackPanel.ContextFlyout>
                                                    <MenuFlyout>
                                                        <MenuFlyoutItem Text="下载客户端" Click="DownloadClient_Click">
                                                            <MenuFlyoutItem.Icon>
                                                                <FontIcon Glyph="&#xE896;" />
                                                            </MenuFlyoutItem.Icon>
                                                        </MenuFlyoutItem>
                                                        <MenuFlyoutItem Text="下载服务端" Click="DownloadServer_Click">
                                                            <MenuFlyoutItem.Icon>
                                                                <FontIcon Glyph="&#xE753;" />
                                                            </MenuFlyoutItem.Icon>
                                                        </MenuFlyoutItem>
                                                    </MenuFlyout>
                                                </StackPanel.ContextFlyout>
                                                <TextBlock Text="{Binding Id}" Style="{StaticResource SubtitleTextBlockStyle}" />
                                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                    <TextBlock Text="{Binding Type}" Style="{StaticResource CaptionTextBlockStyle}" Foreground="Gray" />
                                                    <TextBlock Text=" | " Style="{StaticResource CaptionTextBlockStyle}" Foreground="Gray" />
                                                    <TextBlock Text="{Binding ReleaseTime}" Style="{StaticResource CaptionTextBlockStyle}" Foreground="Gray" />
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </Grid>
                        </Grid>
                    </TabViewItem>

                    <!-- Mod下载标签 -->
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_ModTabHeader" Text="Mod下载" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <animations:Implicit.ShowAnimations>
                                <animations:TranslationAnimation Duration="0:0:0.5" From="0, 40, 0" To="0" EasingMode="EaseOut" />
                                <animations:OpacityAnimation Duration="0:0:0.5" From="0" To="1.0" />
                            </animations:Implicit.ShowAnimations>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- Mod搜索和过滤 - 单行布局 -->
                            <Grid Grid.Row="0" Margin="20,10,20,10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <!-- 第一行：搜索框 + 筛选条件 + 平台选择 -->
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Search Box -->
                                    <AutoSuggestBox
                                        x:Name="ModSearchBox"
                                        x:Uid="ResourceDownloadPage_ModSearchBox"
                                        Grid.Column="0"
                                        QueryIcon="Find"
                                        Margin="0,0,8,0"
                                        Text="{Binding SearchQuery, Mode=TwoWay}"
                                        QuerySubmitted="ModSearchBox_QuerySubmitted"/>

                                    <!-- Mod Loader Filter -->
                                    <ComboBox
                                        x:Name="LoaderComboBox"
                                        x:Uid="ResourceDownloadPage_LoaderComboBox"
                                        Grid.Column="1"
                                        MinWidth="80"
                                        Margin="0,0,4,0"
                                        SelectedValue="{Binding SelectedLoader, Mode=TwoWay}"
                                        SelectedValuePath="Tag"
                                        SelectionChanged="LoaderComboBox_SelectionChanged">
                                        <ComboBoxItem x:Uid="ResourceDownloadPage_AllLoaders" Content="加载器" Tag="all" IsSelected="True" />
                                        <ComboBoxItem Content="Fabric" Tag="fabric" />
                                        <ComboBoxItem Content="Forge" Tag="forge" />
                                        <ComboBoxItem Content="Quilt" Tag="quilt" />
                                        <ComboBoxItem Content="Bolt" Tag="bolt" Visibility="Collapsed"/>
                                        <ComboBoxItem Content="Legacy Fabric" Tag="legacy-fabric" />
                                        <ComboBoxItem Content="LiteLoader" Tag="liteloader" />
                                    </ComboBox>

                                    <!-- Version Filter -->
                                    <ComboBox
                                        x:Name="VersionComboBox"
                                        x:Uid="ResourceDownloadPage_VersionComboBox"
                                        Grid.Column="2"
                                        MinWidth="90"
                                        Margin="0,0,4,0"
                                        ItemsSource="{Binding AvailableVersions, Mode=OneWay}"
                                        SelectedItem="{Binding SelectedVersion, Mode=TwoWay}"
                                        SelectionChanged="VersionComboBox_SelectionChanged">
                                    </ComboBox>

                                    <!-- 类别筛选 -->
                                    <ComboBox
                                        x:Name="ModCategoryComboBox"
                                        x:Uid="ResourceDownloadPage_ModCategoryComboBox"
                                        Grid.Column="3"
                                        MinWidth="80"
                                        Margin="0,0,8,0"
                                        ItemsSource="{Binding ModCategories}"
                                        DisplayMemberPath="DisplayName"
                                        SelectedValuePath="Tag"
                                        SelectedValue="{Binding SelectedModCategory, Mode=TwoWay}"
                                        SelectionChanged="ModCategoryComboBox_SelectionChanged" />

                                    <!-- 平台选择 - 使用 ToggleButtons -->
                                    <StackPanel Grid.Column="4" Orientation="Horizontal" Spacing="0">
                                        <ToggleButton 
                                            x:Name="ModrinthToggle"
                                            x:Uid="ResourceDownloadPage_ModrinthToggle"
                                            IsChecked="{Binding IsModrinthEnabled, Mode=TwoWay}"
                                            Click="ModrinthToggleButton_Click"
                                            CornerRadius="4,0,0,4"
                                            Padding="10,6"
                                            MinWidth="80">
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <FontIcon Glyph="&#xE774;" FontSize="12"/>
                                                <TextBlock Text="Modrinth" FontSize="12"/>
                                            </StackPanel>
                                        </ToggleButton>
                                        <ToggleButton 
                                            x:Name="CurseForgeToggle"
                                            x:Uid="ResourceDownloadPage_CurseForgeToggle"
                                            IsChecked="{Binding IsCurseForgeEnabled, Mode=TwoWay}"
                                            Click="CurseForgeToggleButton_Click"
                                            CornerRadius="0,4,4,0"
                                            Padding="10,6"
                                            MinWidth="80">
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <FontIcon Glyph="&#xE945;" FontSize="12"/>
                                                <TextBlock Text="CurseForge" FontSize="12"/>
                                            </StackPanel>
                                        </ToggleButton>
                                    </StackPanel>
                                </Grid>
                            </Grid>

                            <!-- Error Message -->
                            <Grid
                                Grid.Row="2"
                                Margin="20,10,20,10"
                                Background="#FFFDE7E9"
                                BorderBrush="#FFD53939"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Visibility="{Binding ErrorMessage, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToBoolConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.Column="0"
                                    Text="⚠"
                                    FontSize="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0"
                                    Foreground="#FFD53939"/>
                                <TextBlock
                                    Grid.Column="1"
                                    Text="{Binding ErrorMessage, Mode=OneWay}"
                                    Foreground="#FFD53939"
                                    Style="{ThemeResource BodyTextBlockStyle}"
                                    VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Loading Indicator -->
                            <ProgressRing
                                Grid.Row="2"
                                Margin="20"
                                IsActive="{Binding IsModLoading, Mode=OneWay}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding IsModLoading, Mode=OneWay}"/>

                            <!-- Mod列表 -->
                            <ScrollViewer 
                                x:Name="ModListScrollViewer"
                                Grid.Row="2"
                                Margin="20"
                                Padding="0,0,12,0"
                                VerticalScrollBarVisibility="Auto"
                                ViewChanged="ModListScrollViewer_ScrollChanged">
                                    <!-- Mod列表 -->
                                    <ListView 
                                        x:Name="ModListView"
                                        SelectionMode="Single"
                                        ItemsSource="{Binding Mods, Mode=OneWay}"
                                        CanDragItems="True"
                                        DragItemsStarting="CommunityListView_DragItemsStarting"
                                        CanReorderItems="True"
                                        AllowDrop="True"
                                        IsItemClickEnabled="True"
                                        ItemClick="ModListView_ItemClick"
                                        Visibility="{Binding IsModLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                        <ListView.Resources>
                                            <Style TargetType="ScrollViewer">
                                                <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                                            </Style>
                                        </ListView.Resources>
                                        <ListView.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <VirtualizingStackPanel VirtualizationMode="Recycling"/>
                                            </ItemsPanelTemplate>
                                        </ListView.ItemsPanel>
                                        <ListView.ItemContainerStyle>
                                            <StaticResource ResourceKey="CommunityResourceListViewItemStyle" />
                                        </ListView.ItemContainerStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="models:ModrinthProject">
                                                <Grid Height="120" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                      CornerRadius="8" Padding="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                      BorderThickness="1" Tapped="ModItem_Tapped">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- Mod Icon -->
                                                    <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3" Width="64" Height="64" Margin="0,0,12,0"
                                                            CornerRadius="32" Background="Transparent">
                                                        <Image Stretch="UniformToFill">
                                                            <Image.Source>
                                                                <BitmapImage UriSource="{Binding IconUrl, Mode=OneWay}" DecodePixelWidth="64" DecodePixelHeight="64"/>
                                                            </Image.Source>
                                                        </Image>
                                                    </Border>

                                                    <!-- Mod Name -->
                                                    <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding DisplayTitle, Mode=OneWay}"
                                                               FontSize="16" FontWeight="SemiBold"/>

                                                    <!-- Mod Description -->
                                                    <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding DisplayDescription, Mode=OneWay}"
                                                               Style="{ThemeResource BodyTextBlockStyle}" Opacity="0.8" TextWrapping="WrapWholeWords"
                                                               MaxLines="2" VerticalAlignment="Center"/>

                                                    <!-- Mod Info -->
                                                    <StackPanel Grid.Column="1" Grid.Row="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom">
                                                        <TextBlock Text="{Binding Author, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding LatestSupportedVersion, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding Downloads, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                        <!-- Loading More Indicator -->
                                        <ListView.Footer>
                                            <ProgressRing 
                                                IsActive="{Binding IsModLoadingMore, Mode=OneWay}" 
                                                Width="32" Height="32" 
                                                Margin="0,10,0,10" 
                                                HorizontalAlignment="Center"/>
                                        </ListView.Footer>
                                    </ListView>
                            </ScrollViewer>
                        </Grid>
                    </TabViewItem>

                    <!-- 光影下载标签 -->
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_ShaderPackTabHeader" Text="光影下载" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <animations:Implicit.ShowAnimations>
                                <animations:TranslationAnimation Duration="0:0:0.5" From="0, 40, 0" To="0" EasingMode="EaseOut" />
                                <animations:OpacityAnimation Duration="0:0:0.5" From="0" To="1.0" />
                            </animations:Implicit.ShowAnimations>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- 光影搜索和过滤 -->
                            <Grid Grid.Row="0" Margin="20,10,20,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Search Box -->
                                <AutoSuggestBox
                                    x:Name="ShaderPackSearchBox"
                                    x:Uid="ResourceDownloadPage_ShaderPackSearchBox"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    QueryIcon="Find"
                                    Margin="0,0,8,0"
                                    Text="{Binding ShaderPackSearchQuery, Mode=TwoWay}"
                                    QuerySubmitted="ShaderPackSearchBox_QuerySubmitted"/>

                                <!-- Version Filter -->
                                <ComboBox
                                    x:Name="ShaderPackVersionComboBox"
                                    x:Uid="ResourceDownloadPage_ShaderPackVersionComboBox"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    PlaceholderText="版本"
                                    Margin="0,0,4,0"
                                    MinWidth="90"
                                    ItemsSource="{Binding AvailableVersions, Mode=OneWay}"
                                    SelectedItem="{Binding SelectedShaderPackVersion, Mode=TwoWay}"
                                    SelectionChanged="ShaderPackVersionComboBox_SelectionChanged">
                                </ComboBox>

                                <!-- 类别筛选 -->
                                <ComboBox
                                    x:Name="ShaderPackCategoryComboBox"
                                    x:Uid="ResourceDownloadPage_ShaderPackCategoryComboBox"
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    PlaceholderText="所有类别"
                                    MinWidth="80"
                                    Margin="0,0,8,0"
                                    ItemsSource="{Binding ShaderPackCategories}"
                                    DisplayMemberPath="DisplayName"
                                    SelectedValuePath="Tag"
                                    SelectedValue="{Binding SelectedShaderPackCategory, Mode=TwoWay}"
                                    SelectionChanged="ShaderPackCategoryComboBox_SelectionChanged" />

                                <!-- 平台选择 - 使用 ToggleButtons -->
                                <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="0">
                                    <ToggleButton 
                                        x:Name="ShaderPackModrinthToggle"
                                        x:Uid="ResourceDownloadPage_ModrinthToggle"
                                        IsChecked="{Binding IsModrinthEnabled, Mode=TwoWay}"
                                        Click="ShaderPackModrinthToggleButton_Click"
                                        CornerRadius="4,0,0,4"
                                        Padding="10,6"
                                        MinWidth="80">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon Glyph="&#xE774;" FontSize="12"/>
                                            <TextBlock Text="Modrinth" FontSize="12"/>
                                        </StackPanel>
                                    </ToggleButton>
                                    <ToggleButton 
                                        x:Name="ShaderPackCurseForgeToggle"
                                        x:Uid="ResourceDownloadPage_CurseForgeToggle"
                                        IsChecked="{Binding IsCurseForgeEnabled, Mode=TwoWay}"
                                        Click="ShaderPackCurseForgeToggleButton_Click"
                                        CornerRadius="0,4,4,0"
                                        Padding="10,6"
                                        MinWidth="80">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon Glyph="&#xE945;" FontSize="12"/>
                                            <TextBlock Text="CurseForge" FontSize="12"/>
                                        </StackPanel>
                                    </ToggleButton>
                                </StackPanel>
                            </Grid>

                            <!-- Error Message -->
                            <Grid
                                Grid.Row="2"
                                Margin="20,10,20,10"
                                Background="#FFFDE7E9"
                                BorderBrush="#FFD53939"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Visibility="{Binding ErrorMessage, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToBoolConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.Column="0"
                                    Text="⚠"
                                    FontSize="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0"
                                    Foreground="#FFD53939"/>
                                <TextBlock
                                    Grid.Column="1"
                                    Text="{Binding ErrorMessage, Mode=OneWay}"
                                    Foreground="#FFD53939"
                                    Style="{ThemeResource BodyTextBlockStyle}"
                                    VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Loading Indicator -->
                            <ProgressRing
                                Grid.Row="2"
                                Margin="20"
                                IsActive="{Binding IsShaderPackLoading, Mode=OneWay}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding IsShaderPackLoading, Mode=OneWay}"/>

                            <!-- 光影列表 -->
                            <ScrollViewer 
                                x:Name="ShaderPackListScrollViewer"
                                Grid.Row="2"
                                Margin="20"
                                Padding="0,0,12,0"
                                VerticalScrollBarVisibility="Auto"
                                ViewChanged="ShaderPackListScrollViewer_ScrollChanged">
                                    <!-- 光影列表 -->
                                    <controls:AdaptiveGridView 
                                        x:Name="ShaderPackListView"
                                        SelectionMode="Single"
                                        ItemsSource="{Binding ShaderPacks, Mode=OneWay}"
                                        CanDragItems="True"
                                        DragItemsStarting="CommunityListView_DragItemsStarting"
                                        CanReorderItems="True"
                                        AllowDrop="True"
                                        IsItemClickEnabled="True"
                                        ItemClick="ShaderPackListView_ItemClick"
                                        DesiredWidth="260"
                                        ItemHeight="280"
                                        StretchContentForSingleRow="False"
                                        OneRowModeEnabled="False"
                                        ItemContainerStyle="{StaticResource CardGridViewItemStyle}"
                                        Visibility="{Binding IsShaderPackLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                        <controls:AdaptiveGridView.ItemTemplate>
                                            <DataTemplate x:DataType="models:ModrinthProject">
                                                <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                    CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                    BorderThickness="1" Tapped="ShaderPackItem_Tapped">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="140"/>
                                                        <RowDefinition Height="*"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- Large Image -->
                                                    <Border Grid.Row="0" CornerRadius="8,8,0,0" Background="{ThemeResource LayerFillColorDefaultBrush}">
                                                        <Grid>
                                                            <!-- Fallback/Background: Icon -->
                                                            <Image Source="{Binding IconUrl, Mode=OneWay}" Stretch="UniformToFill"/>
                                                            
                                                            <!-- Blur Layer (Blurs the icon behind it) -->
                                                            <Border>
                                                                <Border.Background>
                                                                    <media:BackdropBlurBrush Amount="10" />
                                                                </Border.Background>
                                                            </Border>

                                                            <!-- Dark Overlay to ensure text readability or consistent look -->
                                                            <Rectangle Fill="{ThemeResource SolidBackgroundFillColorBaseAltBrush}" Opacity="0.4"/>
                                                            
                                                            <!-- Main Image (Sits on top, effectively hiding the blurred background if it exists) -->
                                                            <Image Source="{Binding FeaturedGallery, Mode=OneWay, TargetNullValue={x:Null}}" Stretch="UniformToFill"/>
                                                        </Grid>
                                                    </Border>

                                                    <!-- Content -->
                                                    <Grid Grid.Row="1" Padding="12">
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="*"/>
                                                            <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>

                                                        <!-- Title -->
                                                        <Grid Grid.Row="0" ColumnSpacing="8" Margin="0,0,0,4">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="24"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>
                                                            <Border CornerRadius="4" Width="24" Height="24">
                                                                <Image Source="{Binding IconUrl, Mode=OneWay}" Stretch="UniformToFill"/>
                                                            </Border>
                                                            <TextBlock x:Name="ShaderTitleText" Grid.Column="1" Text="{x:Bind DisplayTitle, Mode=OneWay}"
                                                                       FontSize="14" FontWeight="SemiBold" TextTrimming="CharacterEllipsis" VerticalAlignment="Center">
                                                                <ToolTipService.ToolTip>
                                                                    <ToolTip Content="{x:Bind DisplayTitle, Mode=OneWay}"
                                                                             IsEnabled="{x:Bind ShaderTitleText.IsTextTrimmed, Mode=OneWay}" />
                                                                </ToolTipService.ToolTip>
                                                            </TextBlock>
                                                        </Grid>

                                                        <!-- Description -->
                                                        <TextBlock Grid.Row="1" Text="{Binding DisplayDescription, Mode=OneWay}"
                                                                   Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.8" 
                                                                   TextWrapping="Wrap" MaxLines="2" TextTrimming="CharacterEllipsis"
                                                                   VerticalAlignment="Top"/>

                                                        <!-- Footer -->
                                                        <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom">
                                                            <TextBlock Text="{Binding Author, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.6" TextTrimming="CharacterEllipsis" MaxWidth="100"/>
                                                            <TextBlock Text="·" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.6"/>
                                                            <TextBlock Text="{Binding Downloads, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.6"/>
                                                        </StackPanel>
                                                    </Grid>
                                                </Grid>
                                            </DataTemplate>
                                        </controls:AdaptiveGridView.ItemTemplate>
                                        <!-- Loading More Indicator -->
                                        <controls:AdaptiveGridView.Footer>
                                            <ProgressRing 
                                                IsActive="{Binding IsShaderPackLoadingMore, Mode=OneWay}" 
                                                Width="32" Height="32" 
                                                Margin="0,10,0,10" 
                                                HorizontalAlignment="Center"/>
                                        </controls:AdaptiveGridView.Footer>
                                    </controls:AdaptiveGridView>
                            </ScrollViewer>
                        </Grid>
                    </TabViewItem>

                    <!-- 资源包标签 -->
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="&#xE8B7;" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_ResourcePackTabHeader" Text="资源包下载" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <animations:Implicit.ShowAnimations>
                                <animations:TranslationAnimation Duration="0:0:0.5" From="0, 40, 0" To="0" EasingMode="EaseOut" />
                                <animations:OpacityAnimation Duration="0:0:0.5" From="0" To="1.0" />
                            </animations:Implicit.ShowAnimations>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- 资源包搜索和过滤 -->
                            <Grid Grid.Row="0" Margin="20,10,20,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Search Box -->
                                <AutoSuggestBox
                                    x:Name="ResourcePackSearchBox"
                                    x:Uid="ResourceDownloadPage_ResourcePackSearchBox"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    QueryIcon="Find"
                                    Margin="0,0,8,0"
                                    Text="{Binding ResourcePackSearchQuery, Mode=TwoWay}"
                                    QuerySubmitted="ResourcePackSearchBox_QuerySubmitted"/>

                                <!-- Version Filter -->
                                <ComboBox
                                    x:Name="ResourcePackVersionComboBox"
                                    x:Uid="ResourceDownloadPage_ResourcePackVersionComboBox"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    PlaceholderText="版本"
                                    Margin="0,0,4,0"
                                    MinWidth="90"
                                    ItemsSource="{Binding AvailableVersions, Mode=OneWay}"
                                    SelectedItem="{Binding SelectedResourcePackVersion, Mode=TwoWay}"
                                    SelectionChanged="ResourcePackVersionComboBox_SelectionChanged">
                                </ComboBox>

                                <!-- 类别筛选 -->
                                <ComboBox
                                    x:Name="ResourcePackCategoryComboBox"
                                    x:Uid="ResourceDownloadPage_ResourcePackCategoryComboBox"
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    PlaceholderText="所有类别"
                                    MinWidth="80"
                                    Margin="0,0,8,0"
                                    ItemsSource="{Binding ResourcePackCategories}"
                                    DisplayMemberPath="DisplayName"
                                    SelectedValuePath="Tag"
                                    SelectedValue="{Binding SelectedResourcePackCategory, Mode=TwoWay}"
                                    SelectionChanged="ResourcePackCategoryComboBox_SelectionChanged" />

                                <!-- 平台选择 - 使用 ToggleButtons -->
                                <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="0">
                                    <ToggleButton 
                                        x:Name="ResourcePackModrinthToggle"
                                        x:Uid="ResourceDownloadPage_ModrinthToggle"
                                        IsChecked="{Binding IsModrinthEnabled, Mode=TwoWay}"
                                        Click="ResourcePackModrinthToggleButton_Click"
                                        CornerRadius="4,0,0,4"
                                        Padding="10,6"
                                        MinWidth="80">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon Glyph="&#xE774;" FontSize="12"/>
                                            <TextBlock Text="Modrinth" FontSize="12"/>
                                        </StackPanel>
                                    </ToggleButton>
                                    <ToggleButton 
                                        x:Name="ResourcePackCurseForgeToggle"
                                        x:Uid="ResourceDownloadPage_CurseForgeToggle"
                                        IsChecked="{Binding IsCurseForgeEnabled, Mode=TwoWay}"
                                        Click="ResourcePackCurseForgeToggleButton_Click"
                                        CornerRadius="0,4,4,0"
                                        Padding="10,6"
                                        MinWidth="80">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon Glyph="&#xE945;" FontSize="12"/>
                                            <TextBlock Text="CurseForge" FontSize="12"/>
                                        </StackPanel>
                                    </ToggleButton>
                                </StackPanel>
                            </Grid>

                            <!-- Error Message -->
                            <Grid
                                Grid.Row="2"
                                Margin="20,10,20,10"
                                Background="#FFFDE7E9"
                                BorderBrush="#FFD53939"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Visibility="{Binding ErrorMessage, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToBoolConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.Column="0"
                                    Text="⚠"
                                    FontSize="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0"
                                    Foreground="#FFD53939"/>
                                <TextBlock
                                    Grid.Column="1"
                                    Text="{Binding ErrorMessage, Mode=OneWay}"
                                    Foreground="#FFD53939"
                                    Style="{ThemeResource BodyTextBlockStyle}"
                                    VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Loading Indicator -->
                            <ProgressRing
                                Grid.Row="2"
                                Margin="20"
                                IsActive="{Binding IsResourcePackLoading, Mode=OneWay}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding IsResourcePackLoading, Mode=OneWay}"/>

                            <!-- 资源包列表 -->
                            <ScrollViewer 
                                x:Name="ResourcePackListScrollViewer"
                                Grid.Row="2"
                                Margin="20"
                                Padding="0,0,12,0"
                                VerticalScrollBarVisibility="Auto"
                                ViewChanged="ResourcePackListScrollViewer_ScrollChanged">
                                    <!-- 资源包列表 -->
                                    <controls:AdaptiveGridView 
                                        x:Name="ResourcePackListView"
                                        SelectionMode="Single"
                                        ItemsSource="{Binding ResourcePacks, Mode=OneWay}"
                                        DragItemsStarting="CommunityListView_DragItemsStarting"
                                        CanDragItems="True"
                                        CanReorderItems="True"
                                        AllowDrop="True"
                                        IsItemClickEnabled="True"
                                        ItemClick="ResourcePackListView_ItemClick"
                                        DesiredWidth="260"
                                        ItemHeight="280"
                                        StretchContentForSingleRow="False"
                                        OneRowModeEnabled="False"
                                        ItemContainerStyle="{StaticResource CardGridViewItemStyle}"
                                        Visibility="{Binding IsResourcePackLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                        <controls:AdaptiveGridView.ItemTemplate>
                                            <DataTemplate x:DataType="models:ModrinthProject">
                                                <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                    CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                    BorderThickness="1" Tapped="ResourcePackItem_Tapped">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="140"/>
                                                        <RowDefinition Height="*"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- Large Image -->
                                                    <Border Grid.Row="0" CornerRadius="8,8,0,0" Background="{ThemeResource LayerFillColorDefaultBrush}">
                                                        <Grid>
                                                            <!-- Fallback/Background: Icon -->
                                                            <Image Source="{Binding IconUrl, Mode=OneWay}" Stretch="UniformToFill"/>
                                                            
                                                            <!-- Blur Layer (Blurs the icon behind it) -->
                                                            <Border>
                                                                <Border.Background>
                                                                    <media:BackdropBlurBrush Amount="10" />
                                                                </Border.Background>
                                                            </Border>

                                                            <!-- Dark Overlay to ensure text readability or consistent look -->
                                                            <Rectangle Fill="{ThemeResource SolidBackgroundFillColorBaseAltBrush}" Opacity="0.4"/>
                                                            
                                                            <!-- Main Image (Sits on top, effectively hiding the blurred background if it exists) -->
                                                            <Image Source="{Binding FeaturedGallery, Mode=OneWay, TargetNullValue={x:Null}}" Stretch="UniformToFill"/>
                                                        </Grid>
                                                    </Border>

                                                    <!-- Content -->
                                                    <Grid Grid.Row="1" Padding="12">
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="*"/>
                                                            <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>

                                                        <!-- Title -->
                                                        <Grid Grid.Row="0" ColumnSpacing="8" Margin="0,0,0,4">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="24"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>
                                                            <Border CornerRadius="4" Width="24" Height="24">
                                                                <Image Source="{Binding IconUrl, Mode=OneWay}" Stretch="UniformToFill"/>
                                                            </Border>
                                                            <TextBlock x:Name="ResourcePackTitleText" Grid.Column="1" Text="{x:Bind DisplayTitle, Mode=OneWay}"
                                                                       FontSize="14" FontWeight="SemiBold" TextTrimming="CharacterEllipsis" VerticalAlignment="Center">
                                                                <ToolTipService.ToolTip>
                                                                    <ToolTip Content="{x:Bind DisplayTitle, Mode=OneWay}"
                                                                             IsEnabled="{x:Bind ResourcePackTitleText.IsTextTrimmed, Mode=OneWay}" />
                                                                </ToolTipService.ToolTip>
                                                            </TextBlock>
                                                        </Grid>

                                                        <!-- Description -->
                                                        <TextBlock Grid.Row="1" Text="{Binding DisplayDescription, Mode=OneWay}"
                                                                   Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.8" 
                                                                   TextWrapping="Wrap" MaxLines="2" TextTrimming="CharacterEllipsis"
                                                                   VerticalAlignment="Top"/>

                                                        <!-- Footer -->
                                                        <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom">
                                                            <TextBlock Text="{Binding Author, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.6" TextTrimming="CharacterEllipsis" MaxWidth="100"/>
                                                            <TextBlock Text="·" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.6"/>
                                                            <TextBlock Text="{Binding Downloads, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.6"/>
                                                        </StackPanel>
                                                    </Grid>
                                                </Grid>
                                            </DataTemplate>
                                        </controls:AdaptiveGridView.ItemTemplate>
                                        <!-- Loading More Indicator -->
                                        <controls:AdaptiveGridView.Footer>
                                            <ProgressRing 
                                                IsActive="{Binding IsResourcePackLoadingMore, Mode=OneWay}" 
                                                Width="32" Height="32" 
                                                Margin="0,10,0,10" 
                                                HorizontalAlignment="Center"/>
                                        </controls:AdaptiveGridView.Footer>
                                    </controls:AdaptiveGridView>
                            </ScrollViewer>
                        </Grid>
                    </TabViewItem>
                    
                    <!-- 数据包标签 -->
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="&#xE760;" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_DatapackTabHeader" Text="数据包下载" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <animations:Implicit.ShowAnimations>
                                <animations:TranslationAnimation Duration="0:0:0.5" From="0, 40, 0" To="0" EasingMode="EaseOut" />
                                <animations:OpacityAnimation Duration="0:0:0.5" From="0" To="1.0" />
                            </animations:Implicit.ShowAnimations>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- 数据包搜索和过滤 -->
                            <Grid Grid.Row="0" Margin="20,10,20,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Search Box -->
                                <AutoSuggestBox
                                    x:Name="DatapackSearchBox"
                                    x:Uid="ResourceDownloadPage_DatapackSearchBox"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    PlaceholderText="Search datapacks..."
                                    QueryIcon="Find"
                                    Margin="0,0,8,0"
                                    Text="{Binding DatapackSearchQuery, Mode=TwoWay}"
                                    QuerySubmitted="DatapackSearchBox_QuerySubmitted"/>

                                <!-- Version Filter -->
                                <ComboBox
                                    x:Name="DatapackVersionComboBox"
                                    x:Uid="ResourceDownloadPage_DatapackVersionComboBox"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    PlaceholderText="版本"
                                    Margin="0,0,4,0"
                                    MinWidth="90"
                                    ItemsSource="{Binding AvailableVersions, Mode=OneWay}"
                                    SelectedItem="{Binding SelectedDatapackVersion, Mode=TwoWay}"
                                    SelectionChanged="DatapackVersionComboBox_SelectionChanged">
                                </ComboBox>

                                <!-- 类别筛选 -->
                                <ComboBox
                                    x:Name="DatapackCategoryComboBox"
                                    x:Uid="ResourceDownloadPage_DatapackCategoryComboBox"
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    PlaceholderText="所有类别"
                                    MinWidth="80"
                                    Margin="0,0,8,0"
                                    ItemsSource="{Binding DatapackCategories}"
                                    DisplayMemberPath="DisplayName"
                                    SelectedValuePath="Tag"
                                    SelectedValue="{Binding SelectedDatapackCategory, Mode=TwoWay}"
                                    SelectionChanged="DatapackCategoryComboBox_SelectionChanged" />

                                <!-- 平台选择 - 使用 ToggleButtons -->
                                <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="0">
                                    <ToggleButton 
                                        x:Name="DatapackModrinthToggle"
                                        x:Uid="ResourceDownloadPage_ModrinthToggle"
                                        IsChecked="{Binding IsModrinthEnabled, Mode=TwoWay}"
                                        Click="DatapackModrinthToggleButton_Click"
                                        CornerRadius="4,0,0,4"
                                        Padding="10,6"
                                        MinWidth="80">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon Glyph="&#xE774;" FontSize="12"/>
                                            <TextBlock Text="Modrinth" FontSize="12"/>
                                        </StackPanel>
                                    </ToggleButton>
                                    <ToggleButton 
                                        x:Name="DatapackCurseForgeToggle"
                                        x:Uid="ResourceDownloadPage_CurseForgeToggle"
                                        IsChecked="{Binding IsCurseForgeEnabled, Mode=TwoWay}"
                                        Click="DatapackCurseForgeToggleButton_Click"
                                        CornerRadius="0,4,4,0"
                                        Padding="10,6"
                                        MinWidth="80">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon Glyph="&#xE945;" FontSize="12"/>
                                            <TextBlock Text="CurseForge" FontSize="12"/>
                                        </StackPanel>
                                    </ToggleButton>
                                </StackPanel>
                            </Grid>

                            <!-- Error Message -->
                            <Grid
                                Grid.Row="2"
                                Margin="20,10,20,10"
                                Background="#FFFDE7E9"
                                BorderBrush="#FFD53939"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Visibility="{Binding ErrorMessage, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToBoolConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.Column="0"
                                    Text="⚠"
                                    FontSize="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0"
                                    Foreground="#FFD53939"/>
                                <TextBlock
                                    Grid.Column="1"
                                    Text="{Binding ErrorMessage, Mode=OneWay}"
                                    Foreground="#FFD53939"
                                    Style="{ThemeResource BodyTextBlockStyle}"
                                    VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Loading Indicator -->
                            <ProgressRing
                                Grid.Row="2"
                                Margin="20"
                                IsActive="{Binding IsDatapackLoading, Mode=OneWay}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding IsDatapackLoading, Mode=OneWay}"/>

                            <!-- 数据包列表 -->
                            <ScrollViewer 
                                x:Name="DatapackListScrollViewer"
                                Grid.Row="2"
                                Margin="20"
                                Padding="0,0,12,0"
                                VerticalScrollBarVisibility="Auto"
                                ViewChanged="DatapackListScrollViewer_ScrollChanged">
                                    <!-- 数据包列表 -->
                                    <ListView 
                                        x:Name="DatapackListView"
                                        SelectionMode="Single"
                                        ItemsSource="{Binding Datapacks, Mode=OneWay}"
                                        DragItemsStarting="CommunityListView_DragItemsStarting"
                                        CanDragItems="True"
                                        CanReorderItems="True"
                                        AllowDrop="True"
                                        IsItemClickEnabled="True"
                                        ItemClick="DatapackListView_ItemClick"
                                        Visibility="{Binding IsDatapackLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                        <ListView.Resources>
                                            <Style TargetType="ScrollViewer">
                                                <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                                            </Style>
                                        </ListView.Resources>
                                        <ListView.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <VirtualizingStackPanel VirtualizationMode="Recycling"/>
                                            </ItemsPanelTemplate>
                                        </ListView.ItemsPanel>
                                        <ListView.ItemContainerStyle>
                                            <StaticResource ResourceKey="CommunityResourceListViewItemStyle" />
                                        </ListView.ItemContainerStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="models:ModrinthProject">
                                                <Grid Height="120" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                      CornerRadius="8" Padding="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                      BorderThickness="1" Tapped="DatapackItem_Tapped">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- 数据包图标 -->
                                                    <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3" Width="64" Height="64" Margin="0,0,12,0"
                                                            CornerRadius="32" Background="Transparent">
                                                        <Image Stretch="UniformToFill">
                                                            <Image.Source>
                                                                <BitmapImage UriSource="{Binding IconUrl, Mode=OneWay}" DecodePixelWidth="64" DecodePixelHeight="64"/>
                                                            </Image.Source>
                                                        </Image>
                                                    </Border>

                                                    <!-- 数据包名称 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding DisplayTitle, Mode=OneWay}"
                                                               FontSize="16" FontWeight="SemiBold"/>

                                                    <!-- 数据包描述 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding DisplayDescription, Mode=OneWay}"
                                                               Style="{ThemeResource BodyTextBlockStyle}" Opacity="0.8" TextWrapping="WrapWholeWords"
                                                               MaxLines="2" VerticalAlignment="Center"/>

                                                    <!-- 数据包信息 -->
                                                    <StackPanel Grid.Column="1" Grid.Row="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom">
                                                        <TextBlock Text="{Binding Author, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding LatestSupportedVersion, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding Downloads, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                        <!-- Loading More Indicator -->
                                        <ListView.Footer>
                                            <ProgressRing 
                                                IsActive="{Binding IsDatapackLoadingMore, Mode=OneWay}" 
                                                Width="32" Height="32" 
                                                Margin="0,10,0,10" 
                                                HorizontalAlignment="Center"/>
                                        </ListView.Footer>
                                    </ListView>
                            </ScrollViewer>
                        </Grid>
                    </TabViewItem>
                    
                    <!-- 整合包下载标签 -->
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_ModpackTabHeader" Text="整合包下载" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <animations:Implicit.ShowAnimations>
                                <animations:TranslationAnimation Duration="0:0:0.5" From="0, 40, 0" To="0" EasingMode="EaseOut" />
                                <animations:OpacityAnimation Duration="0:0:0.5" From="0" To="1.0" />
                            </animations:Implicit.ShowAnimations>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- 整合包搜索和过滤 -->
                            <Grid Grid.Row="0" Margin="20,10,20,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Search Box -->
                                <AutoSuggestBox
                                    x:Name="ModpackSearchBox"
                                    x:Uid="ResourceDownloadPage_ModpackSearchBox"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    PlaceholderText="Search modpacks..."
                                    QueryIcon="Find"
                                    Margin="0,0,8,0"
                                    Text="{Binding ModpackSearchQuery, Mode=TwoWay}"
                                    QuerySubmitted="ModpackSearchBox_QuerySubmitted"/>

                                <!-- Version Filter -->
                                <ComboBox
                                    x:Name="ModpackVersionComboBox"
                                    x:Uid="ResourceDownloadPage_ModpackVersionComboBox"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    PlaceholderText="版本"
                                    Margin="0,0,4,0"
                                    MinWidth="90"
                                    ItemsSource="{Binding AvailableVersions, Mode=OneWay}"
                                    SelectedItem="{Binding SelectedModpackVersion, Mode=TwoWay}"
                                    SelectionChanged="ModpackVersionComboBox_SelectionChanged">
                                </ComboBox>

                                <!-- 类别筛选 -->
                                <ComboBox
                                    x:Name="ModpackCategoryComboBox"
                                    x:Uid="ResourceDownloadPage_ModpackCategoryComboBox"
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    PlaceholderText="所有类别"
                                    MinWidth="80"
                                    Margin="0,0,8,0"
                                    ItemsSource="{Binding ModpackCategories}"
                                    DisplayMemberPath="DisplayName"
                                    SelectedValuePath="Tag"
                                    SelectedValue="{Binding SelectedModpackCategory, Mode=TwoWay}"
                                    SelectionChanged="ModpackCategoryComboBox_SelectionChanged" />

                                <!-- 平台选择 - 使用 ToggleButtons -->
                                <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="0">
                                    <ToggleButton 
                                        x:Name="ModpackModrinthToggle"
                                        x:Uid="ResourceDownloadPage_ModrinthToggle"
                                        IsChecked="{Binding IsModrinthEnabled, Mode=TwoWay}"
                                        Click="ModpackModrinthToggleButton_Click"
                                        CornerRadius="4,0,0,4"
                                        Padding="10,6"
                                        MinWidth="80">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon Glyph="&#xE774;" FontSize="12"/>
                                            <TextBlock Text="Modrinth" FontSize="12"/>
                                        </StackPanel>
                                    </ToggleButton>
                                    <ToggleButton 
                                        x:Name="ModpackCurseForgeToggle"
                                        x:Uid="ResourceDownloadPage_CurseForgeToggle"
                                        IsChecked="{Binding IsCurseForgeEnabled, Mode=TwoWay}"
                                        Click="ModpackCurseForgeToggleButton_Click"
                                        CornerRadius="0,4,4,0"
                                        Padding="10,6"
                                        MinWidth="80">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon Glyph="&#xE945;" FontSize="12"/>
                                            <TextBlock Text="CurseForge" FontSize="12"/>
                                        </StackPanel>
                                    </ToggleButton>
                                </StackPanel>
                            </Grid>

                            <!-- Error Message -->
                            <Grid
                                Grid.Row="2"
                                Margin="20,10,20,10"
                                Background="#FFFDE7E9"
                                BorderBrush="#FFD53939"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Visibility="{Binding ErrorMessage, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToBoolConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.Column="0"
                                    Text="⚠"
                                    FontSize="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0"
                                    Foreground="#FFD53939"/>
                                <TextBlock
                                    Grid.Column="1"
                                    Text="{Binding ErrorMessage, Mode=OneWay}"
                                    Foreground="#FFD53939"
                                    Style="{ThemeResource BodyTextBlockStyle}"
                                    VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Loading Indicator -->
                            <ProgressRing
                                Grid.Row="2"
                                Margin="20"
                                IsActive="{Binding IsModpackLoading, Mode=OneWay}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding IsModpackLoading, Mode=OneWay}"/>

                            <!-- 整合包列表 -->
                            <ScrollViewer 
                                x:Name="ModpackListScrollViewer"
                                Grid.Row="2"
                                Margin="20"
                                Padding="0,0,12,0"
                                VerticalScrollBarVisibility="Auto"
                                ViewChanged="ModpackListScrollViewer_ScrollChanged">
                                    <!-- 整合包列表 -->
                                    <ListView 
                                        x:Name="ModpackListView"
                                        SelectionMode="Single"
                                        DragItemsStarting="CommunityListView_DragItemsStarting"
                                        ItemsSource="{Binding Modpacks, Mode=OneWay}"
                                        CanDragItems="True"
                                        CanReorderItems="True"
                                        AllowDrop="True"
                                        IsItemClickEnabled="True"
                                        ItemClick="ModpackListView_ItemClick"
                                        Visibility="{Binding IsModpackLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                        <ListView.Resources>
                                            <Style TargetType="ScrollViewer">
                                                <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                                            </Style>
                                        </ListView.Resources>
                                        <ListView.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <VirtualizingStackPanel VirtualizationMode="Recycling"/>
                                            </ItemsPanelTemplate>
                                        </ListView.ItemsPanel>
                                        <ListView.ItemContainerStyle>
                                            <StaticResource ResourceKey="CommunityResourceListViewItemStyle" />
                                        </ListView.ItemContainerStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="models:ModrinthProject">
                                                <Grid Height="120" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                      CornerRadius="8" Padding="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                      BorderThickness="1" Tapped="ModpackItem_Tapped">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- 整合包图标 -->
                                                    <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3" Width="64" Height="64" Margin="0,0,12,0"
                                                            CornerRadius="32" Background="Transparent">
                                                        <Image Stretch="UniformToFill">
                                                            <Image.Source>
                                                                <BitmapImage UriSource="{Binding IconUrl, Mode=OneWay}" DecodePixelWidth="64" DecodePixelHeight="64"/>
                                                            </Image.Source>
                                                        </Image>
                                                    </Border>

                                                    <!-- 整合包名称 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding DisplayTitle, Mode=OneWay}"
                                                               FontSize="16" FontWeight="SemiBold"/>

                                                    <!-- 整合包描述 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding DisplayDescription, Mode=OneWay}"
                                                               Style="{ThemeResource BodyTextBlockStyle}" Opacity="0.8" TextWrapping="WrapWholeWords"
                                                               MaxLines="2" VerticalAlignment="Center"/>

                                                    <!-- 整合包信息 -->
                                                    <StackPanel Grid.Column="1" Grid.Row="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom">
                                                        <TextBlock Text="{Binding Author, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding LatestSupportedVersion, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding Downloads, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                        <!-- Loading More Indicator -->
                                        <ListView.Footer>
                                            <ProgressRing 
                                                IsActive="{Binding IsModpackLoadingMore, Mode=OneWay}" 
                                                Width="32" Height="32" 
                                                Margin="0,10,0,10" 
                                                HorizontalAlignment="Center"/>
                                        </ListView.Footer>
                                    </ListView>
                            </ScrollViewer>
                        </Grid>
                    </TabViewItem>
                    
                    <!-- 世界标签 -->
                    <TabViewItem>
                        <TabViewItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <FontIcon Glyph="&#xE909;" FontSize="16" />
                                <TextBlock x:Uid="ResourceDownloadPage_WorldTabHeader" Text="世界" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabViewItem.Header>
                        <Grid>
                            <animations:Implicit.ShowAnimations>
                                <animations:TranslationAnimation Duration="0:0:0.5" From="0, 40, 0" To="0" EasingMode="EaseOut" />
                                <animations:OpacityAnimation Duration="0:0:0.5" From="0" To="1.0" />
                            </animations:Implicit.ShowAnimations>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- 世界搜索和过滤 -->
                            <Grid Grid.Row="0" Margin="20,10,20,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Search Box -->
                                <AutoSuggestBox
                                    x:Name="WorldSearchBox"
                                    x:Uid="ResourceDownloadPage_WorldSearchBox"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    PlaceholderText="Search worlds..."
                                    QueryIcon="Find"
                                    Margin="0,0,8,0"
                                    Text="{Binding WorldSearchQuery, Mode=TwoWay}"
                                    QuerySubmitted="WorldSearchBox_QuerySubmitted"/>

                                <!-- Version Filter -->
                                <ComboBox
                                    x:Name="WorldVersionComboBox"
                                    x:Uid="ResourceDownloadPage_WorldVersionComboBox"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    PlaceholderText="版本"
                                    Margin="0,0,4,0"
                                    MinWidth="90"
                                    ItemsSource="{Binding AvailableVersions, Mode=OneWay}"
                                    SelectedItem="{Binding SelectedWorldVersion, Mode=TwoWay}"
                                    SelectionChanged="WorldVersionComboBox_SelectionChanged">
                                </ComboBox>

                                <!-- 类别筛选 -->
                                <ComboBox
                                    x:Name="WorldCategoryComboBox"
                                    x:Uid="ResourceDownloadPage_WorldCategoryComboBox"
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    PlaceholderText="所有类别"
                                    MinWidth="80"
                                    Margin="0,0,8,0"
                                    ItemsSource="{Binding WorldCategories}"
                                    DisplayMemberPath="DisplayName"
                                    SelectedValuePath="Tag"
                                    SelectedValue="{Binding SelectedWorldCategory, Mode=TwoWay}"
                                    SelectionChanged="WorldCategoryComboBox_SelectionChanged" />

                                <!-- 平台选择 - 使用 ToggleButtons -->
                                <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="0">
                                    <ToggleButton 
                                        x:Name="WorldModrinthToggle"
                                        x:Uid="ResourceDownloadPage_ModrinthToggle"
                                        IsChecked="False"
                                        IsEnabled="False"
                                        Click="WorldModrinthToggleButton_Click"
                                        CornerRadius="4,0,0,4"
                                        Padding="10,6"
                                        MinWidth="80"
                                        ToolTipService.ToolTip="Modrinth 不支持世界下载">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon Glyph="&#xE774;" FontSize="12"/>
                                            <TextBlock Text="Modrinth" FontSize="12"/>
                                        </StackPanel>
                                    </ToggleButton>
                                    <ToggleButton 
                                        x:Name="WorldCurseForgeToggle"
                                        x:Uid="ResourceDownloadPage_CurseForgeToggle"
                                        IsChecked="{Binding IsCurseForgeEnabled, Mode=TwoWay}"
                                        Click="WorldCurseForgeToggleButton_Click"
                                        CornerRadius="0,4,4,0"
                                        Padding="10,6"
                                        MinWidth="80">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon Glyph="&#xE945;" FontSize="12"/>
                                            <TextBlock Text="CurseForge" FontSize="12"/>
                                        </StackPanel>
                                    </ToggleButton>
                                </StackPanel>
                            </Grid>

                            <!-- Error Message -->
                            <Grid
                                Grid.Row="2"
                                Margin="20,10,20,10"
                                Background="#FFFDE7E9"
                                BorderBrush="#FFD53939"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Visibility="{Binding ErrorMessage, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToBoolConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.Column="0"
                                    Text="⚠"
                                    FontSize="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0"
                                    Foreground="#FFD53939"/>
                                <TextBlock
                                    Grid.Column="1"
                                    Text="{Binding ErrorMessage, Mode=OneWay}"
                                    Foreground="#FFD53939"
                                    Style="{ThemeResource BodyTextBlockStyle}"
                                    VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Loading Indicator -->
                            <ProgressRing
                                Grid.Row="2"
                                Margin="20"
                                IsActive="{Binding IsWorldLoading, Mode=OneWay}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding IsWorldLoading, Mode=OneWay}"/>

                            <!-- 世界列表 -->
                            <ScrollViewer 
                                x:Name="WorldListScrollViewer"
                                Grid.Row="2"
                                Margin="20"
                                Padding="0,0,12,0"
                                VerticalScrollBarVisibility="Auto"
                                ViewChanged="WorldListScrollViewer_ScrollChanged">
                                    <!-- 世界列表 -->
                                    <ListView 
                                        x:Name="WorldListView"
                                        SelectionMode="Single"
                                        DragItemsStarting="CommunityListView_DragItemsStarting"
                                        ItemsSource="{Binding Worlds, Mode=OneWay}"
                                        CanDragItems="True"
                                        CanReorderItems="True"
                                        AllowDrop="True"
                                        IsItemClickEnabled="True"
                                        ItemClick="WorldListView_ItemClick"
                                        Visibility="{Binding IsWorldLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                        <ListView.Resources>
                                            <Style TargetType="ScrollViewer">
                                                <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
                                            </Style>
                                        </ListView.Resources>
                                        <ListView.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <VirtualizingStackPanel VirtualizationMode="Recycling"/>
                                            </ItemsPanelTemplate>
                                        </ListView.ItemsPanel>
                                        <ListView.ItemContainerStyle>
                                            <StaticResource ResourceKey="CommunityResourceListViewItemStyle" />
                                        </ListView.ItemContainerStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="models:ModrinthProject">
                                                <Grid Height="120" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                      CornerRadius="8" Padding="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                      BorderThickness="1" Tapped="WorldItem_Tapped">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- 世界图标 -->
                                                    <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3" Width="64" Height="64" Margin="0,0,12,0"
                                                            CornerRadius="32" Background="Transparent">
                                                        <Image Stretch="UniformToFill">
                                                            <Image.Source>
                                                                <BitmapImage UriSource="{Binding IconUrl, Mode=OneWay}" DecodePixelWidth="64" DecodePixelHeight="64"/>
                                                            </Image.Source>
                                                        </Image>
                                                    </Border>

                                                    <!-- 世界名称 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding DisplayTitle, Mode=OneWay}"
                                                               FontSize="16" FontWeight="SemiBold"/>

                                                    <!-- 世界描述 -->
                                                    <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding DisplayDescription, Mode=OneWay}"
                                                               Style="{ThemeResource BodyTextBlockStyle}" Opacity="0.8" TextWrapping="WrapWholeWords"
                                                               MaxLines="2" VerticalAlignment="Center"/>

                                                    <!-- 世界信息 -->
                                                    <StackPanel Grid.Column="1" Grid.Row="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom">
                                                        <TextBlock Text="{Binding Author, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding LatestSupportedVersion, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding Downloads, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Opacity="0.7"/>
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                        <!-- Loading More Indicator -->
                                        <ListView.Footer>
                                            <ProgressRing 
                                                IsActive="{Binding IsWorldLoadingMore, Mode=OneWay}" 
                                                Width="32" Height="32" 
                                                Margin="0,10,0,10" 
                                                HorizontalAlignment="Center"/>
                                        </ListView.Footer>
                                    </ListView>
                            </ScrollViewer>
                        </Grid>
                    </TabViewItem>
                </TabView.TabItems>
            </TabView>
        </Grid>
    </Grid>
</Page>